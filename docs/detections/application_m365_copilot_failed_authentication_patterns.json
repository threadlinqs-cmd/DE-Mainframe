{
  "schema_version": "1.2",
  "file_name": "application_m365_copilot_failed_authentication_patterns.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "",
      "Title": ""
    }
  ],
  "Description": "Detects M365 Copilot users with failed authentication attempts, MFA failures, or multi-location access patterns indicating potential credential attacks or account compromise. The detection aggregates M365 Copilot Graph API authentication events per user, calculating metrics like distinct cities/countries accessed, unique IP addresses and browsers, failed login attempts (status containing \"fail\" or \"error\"), and MFA failures (error code 50074). Users are flagged when they access Copilot from multiple cities (cities_count > 1), experience any authentication failures (failed_attempts > 0), or encounter MFA errors (mfa_failures > 0), which are indicators of credential stuffing, brute force attacks, or compromised accounts attempting to bypass multi-factor authentication.",
  "Assumptions": "Assumptions:\n- M365 Copilot access logs are ingested via Splunk Add-on for Microsoft Office 365\n- Azure AD Sign-in logs capture authentication failures\n- MFA is enabled for user accounts\n\nPotential Impact:\n- Credential stuffing or brute force attacks\n- MFA bypass attempts\n- Account compromise with failed authentication trails",
  "origin": "custom",
  "Detection Name": "M365 Copilot Failed Authentication Patterns",
  "Objective": "Detect and alert on users with failed M365 Copilot authentication attempts, MFA failures, or suspicious multi-location access indicating credential attacks.",
  "Severity/Priority": "Medium",
  "Analyst Next Steps": "1. Review failed authentication attempts and error codes\n2. Check if MFA failures indicate bypass attempts\n3. Verify geographic locations for impossible travel scenarios\n4. Contact user to confirm if they experienced login issues\n5. Consider password reset and session revocation if compromise is suspected",
  "Blind_Spots_False_Positives": "Blind Spots:\n- Authentication events not captured in Graph API logs\n- Network-level failures not reaching Azure AD\n- Legitimate password resets during travel\n\nFalse Positives:\n- Legitimate users experiencing network connectivity issues, traveling employees with intermittent VPN connections, users in regions with unstable internet infrastructure, or password reset activities during business travel may trigger false positives.",
  "Required_Data_Sources": "M365 Copilot Graph API",
  "First Created": "2025-09-24T00:00:00.000Z",
  "Last Modified": "2026-01-22T00:00:00.000Z",
  "Search String": "`m365_copilot_graph_api` (appDisplayName=\"*Copilot*\" OR appDisplayName=\"M365ChatClient\" OR appDisplayName=\"OfficeAIAppChatCopilot\") | eval user = userPrincipalName | stats count as events, dc(location.city) as cities_count, values(location.city) as city_list, dc(location.countryOrRegion) as countries_count, values(location.countryOrRegion) as country_list, dc(ipAddress) as ip_count, values(ipAddress) as ip_addresses, sum(eval(if(match(status, \"(?i)fail|error\"), 1, 0))) as failed_attempts, sum(eval(if(match(_raw, \"50074\"), 1, 0))) as mfa_failures, dc(deviceDetail.browser) as browser_count, values(deviceDetail.browser) as browsers_used, min(_time) as first_seen, max(_time) as last_seen by user | eval first_seen = strftime(first_seen, \"%Y-%m-%d %H:%M:%S\") | eval last_seen = strftime(last_seen, \"%Y-%m-%d %H:%M:%S\") | where cities_count > 1 OR failed_attempts > 0 OR mfa_failures > 0 | sort -mfa_failures, -failed_attempts, -countries_count | `m365_copilot_failed_authentication_patterns_filter`",
  "Splunk_App_Context": "search",
  "Search_Duration": "-24h",
  "Cron Schedule": "0 * * * *",
  "Schedule Window": "5",
  "Schedule Priority": "default",
  "Trigger Condition": "Number of results is greater than 0",
  "Throttling": {
    "enabled": 1,
    "fields": "user",
    "period": "1h"
  },
  "Risk": [
    {
      "risk_object_field": "user",
      "risk_object_type": "user",
      "risk_score": 30
    }
  ],
  "Notable Title": "M365 Copilot Failed Authentication Pattern Detected for $user$",
  "Notable Description": "User $user$ exhibited suspicious M365 Copilot authentication patterns with $failed_attempts$ failed login attempts, $mfa_failures$ MFA failures, and access from $cities_count$ different locations, indicating potential credential compromise or brute force attack.",
  "Security Domain": "endpoint",
  "Drilldown Name (Legacy)": "View Events Associated to this Notable on Endpoint",
  "Drilldown Search (Legacy)": "`m365_copilot_graph_api` userPrincipalName=\"$user$\" | table _time userPrincipalName status location.city ipAddress",
  "Drilldown Earliest Offset (Legacy)": "2592000",
  "Drilldown Latest Offset (Legacy)": "86400",
  "Mitre ID": [
    "T1110"
  ],
  "Drilldown Name 1": "View the detection results for \"$user$\"",
  "Drilldown Search 1": "%original_detection_search% | search  \"$user = $user$\"",
  "Drilldown Earliest 1": "$info_min_time$",
  "Drilldown Latest 1": "$info_max_time$",
  "Drilldown Name 2": "View risk events for the last 7 days for \"$user$\"",
  "Drilldown Search 2": "| from datamodel Risk.All_Risk | search normalized_risk_object=\"$user$\" | where _time >= relative_time(now(), \"-168h@h\") | stats count min(_time) as firstTime max(_time) as lastTime values(search_name) as \"Search Name\" values(risk_message) as \"Risk Message\" values(analyticstories) as \"Analytic Stories\" values(annotations._all) as \"Annotations\" values(annotations.mitre_attack.mitre_tactic) as \"ATT&CK Tactics\" by normalized_risk_object | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`",
  "Drilldown Earliest 2": "$info_min_time$",
  "Drilldown Latest 2": "$info_max_time$",
  "Drilldown Name 3": "",
  "Drilldown Search 3": "",
  "Drilldown Earliest 3": null,
  "Drilldown Latest 3": null,
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null,
  "Proposed Test Plan": ""
}