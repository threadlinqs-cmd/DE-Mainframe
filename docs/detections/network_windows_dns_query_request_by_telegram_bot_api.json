{
  "schema_version": "1.2",
  "file_name": "network_windows_dns_query_request_by_telegram_bot_api.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "Teoderick Contreras, Splunk",
      "Title": ""
    }
  ],
  "Description": "The following analytic detects the execution of a DNS query by a process to the associated Telegram API domain, which could indicate access via a Telegram bot commonly used by malware for command and control (C2) communications. By monitoring DNS queries related to Telegram's infrastructure, the detection identifies potential attempts to establish covert communication channels between a compromised system and external malicious actors. This behavior is often observed in cyberattacks where Telegram bots are used to receive commands or exfiltrate data, making it a key indicator of suspicious or malicious activity within a network.",
  "Assumptions": "Assumptions:\nTo successfully implement this search, you need to be ingesting logs with the process name and eventcode = 22 dnsquery executions from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.\n\nPotential Impact:\nHigh - C2 communication via Telegram bot, potential data exfiltration.",
  "origin": "custom",
  "Detection Name": "Windows DNS Query Request by Telegram Bot API",
  "Objective": "Detect DNS queries to Telegram API that may indicate malware using Telegram bots for command and control communications.",
  "Severity/Priority": "medium",
  "Analyst Next Steps": "1. Identify the process making the Telegram API query.\n2. Investigate if the process is legitimate or potentially malicious.\n3. Check for other signs of C2 activity or data exfiltration.\n4. Block Telegram API if not legitimate for the organization.",
  "Blind_Spots_False_Positives": "Known False Positives: a third party automation using telegram API.",
  "Required_Data_Sources": "Sysmon EventID 22",
  "First Created": "2024-08-07T00:00:00.000Z",
  "Last Modified": "2025-08-22T00:00:00.000Z",
  "Search String": "`sysmon` EventCode=22  query = \"api.telegram.org\" process_name != \"telegram.exe\" | stats count min(_time) as firstTime max(_time) as lastTime by answer answer_count dvc process_exec process_guid process_name query query_count reply_code_id signature signature_id src user_id vendor_product QueryName QueryResults QueryStatus | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_dns_query_request_by_telegram_bot_api_filter`",
  "Splunk_App_Context": "",
  "Search_Duration": "",
  "Cron Schedule": "",
  "Schedule Window": "",
  "Schedule Priority": "default",
  "Trigger Condition": "",
  "Throttling": {
    "enabled": 0,
    "fields": "",
    "period": ""
  },
  "Risk": [
    {
      "risk_object_field": "dvc",
      "risk_object_type": "system",
      "risk_score": 36
    }
  ],
  "Notable Title": "Windows DNS Query Request by Telegram Bot API",
  "Notable Description": "DNS query by a telegram bot [$query$] on [$dvc$].",
  "Security Domain": "endpoint",
  "Drilldown Name (Legacy)": "View Events Associated to this Notable on ",
  "Drilldown Search (Legacy)": "",
  "Drilldown Earliest Offset (Legacy)": "2592000",
  "Drilldown Latest Offset (Legacy)": "86400",
  "Mitre ID": [
    "T1071.004",
    "T1102.002"
  ],
  "Drilldown Name 1": "View the detection results for - \"$dest$\"",
  "Drilldown Search 1": "%original_detection_search% | search  dest = \"$dest$\"",
  "Drilldown Earliest 1": "$info_min_time$",
  "Drilldown Latest 1": "$info_max_time$",
  "Drilldown Name 2": "View risk events for the last 7 days for - \"$dest$\"",
  "Drilldown Search 2": "| from datamodel Risk.All_Risk | search normalized_risk_object IN (\"$dest$\") starthoursago=168  | stats count min(_time) as firstTime max(_time) as lastTime values(search_name) as \"Search Name\" values(risk_message) as \"Risk Message\" values(analyticstories) as \"Analytic Stories\" values(annotations._all) as \"Annotations\" values(annotations.mitre_attack.mitre_tactic) as \"ATT&CK Tactics\" by normalized_risk_object | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`",
  "Drilldown Earliest 2": "$info_min_time$",
  "Drilldown Latest 2": "$info_max_time$",
  "Drilldown Name 3": "",
  "Drilldown Search 3": "",
  "Drilldown Earliest 3": null,
  "Drilldown Latest 3": null,
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null,
  "Proposed Test Plan": ""
}