{
    "schema_version": "1.2",
    "file_name": "T1055_003_browser_process_injection_remote_debugging.json",
    "Roles": [
      {
        "Role": "Requestor",
        "Name": "",
        "Title": ""
      },
      {
        "Role": "Business Owner",
        "Name": "",
        "Title": ""
      },
      {
        "Role": "Technical Owner",
        "Name": "",
        "Title": ""
      }
    ],
    "Description": "This detection identifies potential process injection attacks targeting browser processes and sensitive credential-handling applications. Adversaries leverage Windows API calls such as SetThreadContext, CreateRemoteThread, and QueueUserApc to inject malicious code into legitimate processes like Chrome, Edge, Firefox, and credential management tools (KeePass, FileZilla, WinSCP, PuTTY). This technique is commonly used to enable remote debugging capabilities in browsers, allowing attackers to intercept credentials, session cookies, authentication tokens, and other sensitive data in real-time. The attack bypasses traditional endpoint security controls by operating within trusted processes.",
    "Assumptions": "Assumptions:\n- Microsoft Defender for Endpoint is deployed and actively reporting to Azure Event Hub\n- Target processes (browsers, credential managers) are running in the environment\n- The mscs:azure:eventhub:defender sourcetype is properly configured and ingesting data\n- API call monitoring is enabled in Defender for Endpoint\n\nPotential Impact:\n- Credential theft and session hijacking\n- Unauthorized access to sensitive systems via stolen SSH/FTP credentials\n- Password database extraction from KeePass\n- Browser-based MFA bypass through cookie/token theft\n- Lateral movement using harvested credentials",
    "origin": "custom",
    "Detection Name": "T1055.003 â€“ Process Injection - Browser Process Injection to Enable Remote Debugging",
    "Objective": "Detect and alert on process injection attempts targeting browser processes and credential management applications that may indicate an adversary attempting to enable remote debugging capabilities for credential harvesting, session hijacking, or data exfiltration.",
    "Severity/Priority": "High",
    "Analyst Next Steps": "1. Identify the initiating process (properties.InitiatingProcessFileName) and examine its legitimacy - is it a known LOLBin, unsigned binary, or running from a suspicious path?\n2. Review the initiating process command line for suspicious arguments such as --remote-debugging-port, --headless, or encoded commands\n3. Check if the affected device (properties.DeviceName) has had recent suspicious activity (malware alerts, unusual logins, policy violations)\n4. Investigate the SHA1 hash of the initiating process against threat intelligence platforms (VirusTotal, MISP)\n5. Determine if the user account associated with the activity is compromised by reviewing recent authentication events\n6. Check for persistence mechanisms on the affected host (scheduled tasks, registry run keys, services)\n7. Look for network connections from the target process to external IPs, especially on uncommon ports\n8. Isolate the endpoint if malicious activity is confirmed and preserve forensic evidence\n9. Reset credentials for any applications potentially compromised (browser sessions, KeePass databases, SSH/FTP accounts)",
    "Blind_Spots_False_Positives": "Blind Spots:\n- Process injection techniques using NtMapViewOfSection or other less common APIs not covered by this detection\n- Attackers using fileless malware that doesn't trigger Defender API monitoring\n- Injection into browser processes not included in the filter list (Opera, Brave, Vivaldi)\n- Legitimate remote debugging enabled via command-line arguments rather than injection\n- Environments where Defender for Endpoint is not deployed or API monitoring is disabled\n\nFalse Positives:\n- Legitimate debugging tools used by developers (Visual Studio, Chrome DevTools remote debugging)\n- Endpoint security products that use similar injection techniques for protection\n- Accessibility software that interacts with browser processes\n- Browser extensions or plugins that utilize remote APIs\n- Automated testing frameworks (Selenium, Puppeteer) that enable remote debugging\n- IT administration tools that interact with process memory for legitimate purposes",
    "Required_Data_Sources": "Microsoft Defender for Endpoint via Azure Event Hub (sourcetype: mscs:azure:eventhub:defender), specifically the DeviceEvents table with ActionType fields capturing API call telemetry (SetThreadContextRemoteApiCall, CreateRemoteThreadApiCall, QueueUserApcRemoteApiCall)",
    "First Created": "2025-01-19T00:00:00.000Z",
    "Last Modified": "2025-01-19T17:29:29.029Z",
    "Search String": "index=azure_cloud sourcetype=mscs:azure:eventhub:defender \n(properties.ActionType=\"SetThreadContextRemoteApiCall\" OR properties.ActionType=\"CreateRemoteThreadApiCall\" OR properties.ActionType=\"QueueUserApcRemoteApiCall\")\nproperties.FileName IN (\"msedge.exe\",\"chrome.exe\",\"msedgewebview2.exe\", \"firefox.exe\", \"keypass.exe\", \"filezilla.exe\", \"winscp.exe\", \"putty.exe\")\n| table _time properties.DeviceName properties.FileName properties.FolderPath properties.SHA1 properties.ProcessCommandLine properties.InitiatingProcessFileName properties.InitiatingProcessCommandLine user",
    "Splunk_App_Context": "search",
    "Search_Duration": "-15m",
    "Cron Schedule": "*/15 * * * *",
    "Schedule Window": "5",
    "Schedule Priority": "default",
    "Trigger Condition": "Number of results is greater than 0",
    "Throttling": {
      "enabled": 1,
      "fields": "properties.DeviceName,properties.InitiatingProcessFileName",
      "period": "1h"
    },
    "Risk": [
      {
        "risk_object_field": "properties.DeviceName",
        "risk_object_type": "system",
        "risk_score": 80
      },
      {
        "risk_object_field": "user",
        "risk_object_type": "user",
        "risk_score": 60
      }
    ],
    "Notable Title": "Process Injection Detected: $properties.InitiatingProcessFileName$ injected into $properties.FileName$ on $properties.DeviceName$",
    "Notable Description": "A process injection attack was detected on $properties.DeviceName$. The process $properties.InitiatingProcessFileName$ attempted to inject code into $properties.FileName$ using $properties.ActionType$. This technique is commonly used to enable remote debugging in browsers for credential theft or to extract sensitive data from credential management applications. Immediate investigation is recommended to determine if this is malicious activity or a false positive from legitimate software.",
    "Security Domain": "endpoint",
    "Drilldown Name (Legacy)": "View Events Associated to this Notable on Defender",
    "Drilldown Search (Legacy)": "index=azure_cloud sourcetype=mscs:azure:eventhub:defender properties.DeviceName=\"$properties.DeviceName$\" | table _time properties.ActionType properties.FileName properties.InitiatingProcessFileName properties.ProcessCommandLine user",
    "Drilldown Earliest Offset (Legacy)": "2592000",
    "Drilldown Latest Offset (Legacy)": "86400",
    "Mitre ID": ["T1055.003", "T1185", "T1539", "T1555"],
    "Drilldown Name 1": "Investigate All Process Injection Activity by Initiating Process",
    "Drilldown Search 1": "index=azure_cloud sourcetype=mscs:azure:eventhub:defender (properties.ActionType=\"SetThreadContextRemoteApiCall\" OR properties.ActionType=\"CreateRemoteThreadApiCall\" OR properties.ActionType=\"QueueUserApcRemoteApiCall\" OR properties.ActionType=\"WriteProcessMemoryApiCall\" OR properties.ActionType=\"NtAllocateVirtualMemoryApiCall\") properties.InitiatingProcessFileName=\"$properties.InitiatingProcessFileName$\" | stats count by _time properties.DeviceName properties.FileName properties.InitiatingProcessFileName properties.InitiatingProcessCommandLine properties.ActionType user | sort -_time",
    "Drilldown Earliest 1": "-30d",
    "Drilldown Latest 1": "now",
    "Drilldown Name 2": "Review All Endpoint Activity for Affected Device",
    "Drilldown Search 2": "index=azure_cloud sourcetype=mscs:azure:eventhub:defender properties.DeviceName=\"$properties.DeviceName$\" | stats count by properties.ActionType properties.FileName properties.InitiatingProcessFileName | sort -count | head 50",
    "Drilldown Earliest 2": "-7d",
    "Drilldown Latest 2": "now",
    "Drilldown Name 3": "",
    "Drilldown Search 3": "",
    "Drilldown Earliest 3": null,
    "Drilldown Latest 3": null,
    "Drilldown Name 4": "",
    "Drilldown Search 4": "",
    "Drilldown Earliest 4": null,
    "Drilldown Latest 4": null,
    "Drilldown Name 5": "",
    "Drilldown Search 5": "",
    "Drilldown Earliest 5": null,
    "Drilldown Latest 5": null,
    "Drilldown Name 6": "",
    "Drilldown Search 6": "",
    "Drilldown Earliest 6": null,
    "Drilldown Latest 6": null,
    "Drilldown Name 7": "",
    "Drilldown Search 7": "",
    "Drilldown Earliest 7": null,
    "Drilldown Latest 7": null,
    "Drilldown Name 8": "",
    "Drilldown Search 8": "",
    "Drilldown Earliest 8": null,
    "Drilldown Latest 8": null,
    "Drilldown Name 9": "",
    "Drilldown Search 9": "",
    "Drilldown Earliest 9": null,
    "Drilldown Latest 9": null,
    "Drilldown Name 10": "",
    "Drilldown Search 10": "",
    "Drilldown Earliest 10": null,
    "Drilldown Latest 10": null,
    "Drilldown Name 11": "",
    "Drilldown Search 11": "",
    "Drilldown Earliest 11": null,
    "Drilldown Latest 11": null,
    "Drilldown Name 12": "",
    "Drilldown Search 12": "",
    "Drilldown Earliest 12": null,
    "Drilldown Latest 12": null,
    "Drilldown Name 13": "",
    "Drilldown Search 13": "",
    "Drilldown Earliest 13": null,
    "Drilldown Latest 13": null,
    "Drilldown Name 14": "",
    "Drilldown Search 14": "",
    "Drilldown Earliest 14": null,
    "Drilldown Latest 14": null,
    "Drilldown Name 15": "",
    "Drilldown Search 15": "",
    "Drilldown Earliest 15": null,
    "Drilldown Latest 15": null,
    "Proposed Test Plan": "Test Plan:\n\n1. Atomic Red Team Test (T1055.003):\n   - Execute Atomic Test #1: Process Injection via CreateRemoteThread\n   - Command: Invoke-AtomicTest T1055.003 -TestNumbers 1\n   - Expected Result: Alert should trigger when injection targets monitored processes\n\n2. Manual Validation:\n   - Use a controlled penetration testing tool (Cobalt Strike, Metasploit) in a test environment\n   - Perform process injection into chrome.exe or msedge.exe\n   - Verify the detection fires and captures the correct initiating process\n\n3. Browser Remote Debugging Test:\n   - Use a tool like ChromeDP or Puppeteer to inject and enable remote debugging\n   - Verify detection captures the injection API calls\n\n4. False Positive Validation:\n   - Run common developer tools (Visual Studio debugger, Chrome DevTools)\n   - Document any legitimate tools that trigger the detection\n   - Update exclusions if necessary\n\n5. Field Extraction Verification:\n   - Confirm all table fields are properly populated\n   - Verify DeviceName, FileName, InitiatingProcessFileName, and user fields contain expected values\n\n6. Throttling Test:\n   - Trigger multiple alerts for the same device/process combination\n   - Verify throttling prevents alert fatigue (1 alert per hour per unique combination)"
  }
