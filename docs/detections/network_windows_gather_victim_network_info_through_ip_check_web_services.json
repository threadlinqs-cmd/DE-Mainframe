{
  "schema_version": "1.2",
  "file_name": "network_windows_gather_victim_network_info_through_ip_check_web_services.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "Teoderick Contreras, Splunk",
      "Title": ""
    }
  ],
  "Description": "The following analytic detects processes attempting to connect to known IP check web services. This behavior is identified using Sysmon EventCode 22 logs, specifically monitoring DNS queries to services like \"wtfismyip.com\" and \"ipinfo.io\". This activity is significant as it is commonly used by malware, such as Trickbot, for reconnaissance to determine the infected machine's IP address. If confirmed malicious, this could allow attackers to gather network information, aiding in further attacks or lateral movement within the network.",
  "Assumptions": "Assumptions:\nTo successfully implement this search, you need to be ingesting logs with the process name, dns query name process path, and query status from your endpoints like EventCode 22. If you are using Sysmon, you must have at least version 12 of the Sysmon TA.\n\nPotential Impact:\nMedium - Reconnaissance activity that could lead to further attacks or lateral movement.",
  "origin": "custom",
  "Detection Name": "Windows Gather Victim Network Info Through Ip Check Web Services",
  "Objective": "Detect processes making DNS queries to IP check services that may indicate malware reconnaissance activity.",
  "Severity/Priority": "medium",
  "Analyst Next Steps": "1. Identify the process making the IP check query.\n2. Determine if the process is legitimate or potentially malicious.\n3. Correlate with other suspicious activities from the same host.\n4. Check for known malware signatures or behavior.",
  "Blind_Spots_False_Positives": "Known False Positives: Filter internet browser application to minimize the false positive of this detection.",
  "Required_Data_Sources": "Sysmon EventID 22",
  "First Created": "2022-08-01T00:00:00.000Z",
  "Last Modified": "2025-10-31T00:00:00.000Z",
  "Search String": "`sysmon` EventCode=22  QueryName IN (\"*wtfismyip.com\", \"*checkip.*\", \"*ipecho.net\", \"*ipinfo.io\", \"*api.ipify.org\", \"*icanhazip.com\", \"*ip.anysrc.com\",\"*api.ip.sb\", \"ident.me\", \"www.myexternalip.com\", \"*zen.spamhaus.org\", \"*cbl.abuseat.org\", \"*b.barracudacentral.org\", \"*dnsbl-1.uceprotect.net\", \"*spam.dnsbl.sorbs.net\", \"*iplogger.org*\", \"*ip-api.com*\", \"*geoip.*\", \"*icanhazip.*\", \"*ipwho.is*\", \"*ifconfig.me*\", \"*myip.com*\", \"*ipstack.com*\", \"*myexternalip.com*\", \"*ip-api.io*\", \"*trackip.net*\", \"*ipgeolocation.io*\", \"*ipfind.io*\", \"*freegeoip.app*\", \"*ipv4bot.whatismyipaddress.com*\") |  stats  min(_time) as firstTime max(_time) as lastTime count by answer answer_count dvc process_exec process_guid process_name query query_count reply_code_id signature signature_id src user_id vendor_product QueryName QueryResults QueryStatus | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_gather_victim_network_info_through_ip_check_web_services_filter`",
  "Splunk_App_Context": "",
  "Search_Duration": "",
  "Cron Schedule": "",
  "Schedule Window": "",
  "Schedule Priority": "default",
  "Trigger Condition": "",
  "Throttling": {
    "enabled": 0,
    "fields": "",
    "period": ""
  },
  "Risk": [
    {
      "risk_object_field": "dvc",
      "risk_object_type": "system",
      "risk_score": 36
    }
  ],
  "Notable Title": "Windows Gather Victim Network Info Through Ip Check Web Services",
  "Notable Description": "a network connection on known abused web services from $dvc$",
  "Security Domain": "endpoint",
  "Drilldown Name (Legacy)": "View Events Associated to this Notable on ",
  "Drilldown Search (Legacy)": "",
  "Drilldown Earliest Offset (Legacy)": "2592000",
  "Drilldown Latest Offset (Legacy)": "86400",
  "Mitre ID": [
    "T1590.005"
  ],
  "Drilldown Name 1": "View the detection results for - \"$dest$\"",
  "Drilldown Search 1": "%original_detection_search% | search  dest = \"$dest$\"",
  "Drilldown Earliest 1": "$info_min_time$",
  "Drilldown Latest 1": "$info_max_time$",
  "Drilldown Name 2": "View risk events for the last 7 days for - \"$dest$\"",
  "Drilldown Search 2": "| from datamodel Risk.All_Risk | search normalized_risk_object IN (\"$dest$\") starthoursago=168  | stats count min(_time) as firstTime max(_time) as lastTime values(search_name) as \"Search Name\" values(risk_message) as \"Risk Message\" values(analyticstories) as \"Analytic Stories\" values(annotations._all) as \"Annotations\" values(annotations.mitre_attack.mitre_tactic) as \"ATT&CK Tactics\" by normalized_risk_object | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`",
  "Drilldown Earliest 2": "$info_min_time$",
  "Drilldown Latest 2": "$info_max_time$",
  "Drilldown Name 3": "",
  "Drilldown Search 3": "",
  "Drilldown Earliest 3": null,
  "Drilldown Latest 3": null,
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null,
  "Proposed Test Plan": ""
}