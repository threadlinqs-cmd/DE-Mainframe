{
  "schema_version": "1.2",
  "file_name": "T1087_002_adsisearcher_account_discovery.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "",
      "Title": ""
    }
  ],
  "Description": "The following analytic detects the use of the `[Adsisearcher]` type accelerator in PowerShell to query Active Directory for domain users. It leverages PowerShell Script Block Logging (EventCode=4104) to identify script blocks containing `[adsisearcher]`, `objectcategory=user`, and `.findAll()`. This activity is significant as it may indicate an attempt by adversaries or Red Teams to enumerate domain users for situational awareness and Active Directory discovery. If confirmed malicious, this could lead to further reconnaissance, privilege escalation, or lateral movement within the network.",
  "Assumptions": "Assumptions:\n- PowerShell Script Block Logging (EventCode 4104) is enabled\n- PowerShell operational logs are ingested into Splunk\n- The powershell macro is properly configured\n\nPotential Impact:\n- Domain user enumeration\n- Active Directory reconnaissance\n- Preparation for privilege escalation or lateral movement",
  "origin": "custom",
  "Detection Name": "AdsiSearcher Account Discovery",
  "Objective": "Detect and alert on the use of [Adsisearcher] type accelerator in PowerShell to query Active Directory for domain users, which may indicate reconnaissance activity.",
  "Severity/Priority": "Medium",
  "Analyst Next Steps": "1. Review the full PowerShell script block for additional context\n2. Identify the user executing the PowerShell command\n3. Determine if this is authorized administrative activity or Red Team testing\n4. Check for other reconnaissance activities from the same endpoint\n5. Investigate if the user account has been compromised",
  "Blind_Spots_False_Positives": "Blind Spots:\n- PowerShell commands executed in constrained language mode\n- AD queries using other methods (net user, dsquery, etc.)\n\nFalse Positives:\n- Administrators or power users using this command for troubleshooting\n- Legitimate IT automation scripts",
  "Required_Data_Sources": "Powershell Script Block Logging 4104",
  "First Created": "2025-10-14T00:00:00.000Z",
  "Last Modified": "2026-01-22T00:00:00.000Z",
  "Search String": "`powershell` EventCode=4104 ScriptBlockText = \"*[adsisearcher]*\" ScriptBlockText = \"*objectcategory=user*\" ScriptBlockText = \"*.findAll()*\" | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by dest signature signature_id user_id vendor_product EventID Guid Opcode Name Path ProcessID ScriptBlockId ScriptBlockText | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `adsisearcher_account_discovery_filter`",
  "Splunk_App_Context": "search",
  "Search_Duration": "-15m",
  "Cron Schedule": "*/15 * * * *",
  "Schedule Window": "5",
  "Schedule Priority": "default",
  "Trigger Condition": "Number of results is greater than 0",
  "Throttling": {
    "enabled": 1,
    "fields": "dest,user_id",
    "period": "1h"
  },
  "Risk": [
    {
      "risk_object_field": "dest",
      "risk_object_type": "system",
      "risk_score": 25
    },
    {
      "risk_object_field": "user_id",
      "risk_object_type": "user",
      "risk_score": 25
    }
  ],
  "Notable Title": "AdsiSearcher Account Discovery Detected on $dest$",
  "Notable Description": "Powershell process has been used for user enumeration on $dest$",
  "Security Domain": "endpoint",
  "Drilldown Name (Legacy)": "View Events Associated to this Notable on Endpoint",
  "Drilldown Search (Legacy)": "`powershell` EventCode=4104 dest=\"$dest$\" | table _time ScriptBlockText user_id",
  "Drilldown Earliest Offset (Legacy)": "2592000",
  "Drilldown Latest Offset (Legacy)": "86400",
  "Mitre ID": [
    "T1087.002"
  ],
  "Drilldown Name 1": "View the detection results for - \"$dest$\" and \"$user_id$\"",
  "Drilldown Search 1": "%original_detection_search% | search  dest = \"$dest$\" user_id = \"$user_id$\"",
  "Drilldown Earliest 1": "$info_min_time$",
  "Drilldown Latest 1": "$info_max_time$",
  "Drilldown Name 2": "View risk events for the last 7 days for - \"$dest$\" and \"$user_id$\"",
  "Drilldown Search 2": "| from datamodel Risk.All_Risk | search normalized_risk_object IN (\"$dest$\", \"$user_id$\") starthoursago=168  | stats count min(_time) as firstTime max(_time) as lastTime values(search_name) as \"Search Name\" values(risk_message) as \"Risk Message\" values(analyticstories) as \"Analytic Stories\" values(annotations._all) as \"Annotations\" values(annotations.mitre_attack.mitre_tactic) as \"ATT&CK Tactics\" by normalized_risk_object | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`",
  "Drilldown Earliest 2": "$info_min_time$",
  "Drilldown Latest 2": "$info_max_time$",
  "Drilldown Name 3": "",
  "Drilldown Search 3": "",
  "Drilldown Earliest 3": null,
  "Drilldown Latest 3": null,
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null,
  "Proposed Test Plan": ""
}