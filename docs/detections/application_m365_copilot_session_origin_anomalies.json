{
  "schema_version": "1.2",
  "file_name": "application_m365_copilot_session_origin_anomalies.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "",
      "Title": ""
    }
  ],
  "Description": "Detects M365 Copilot users accessing from multiple geographic locations to identify potential account compromise, credential sharing, or impossible travel patterns. The detection aggregates M365 Copilot Graph API events per user, calculating distinct cities and countries accessed, unique IP addresses, and the observation timeframe to compute a locations-per-day metric that measures geographic mobility. Users accessing Copilot from more than one city (cities_count > 1) are flagged and sorted by country and city diversity, surfacing accounts exhibiting anomalous geographic patterns that suggest compromised credentials being used from distributed locations or simultaneous access from impossible travel distances.",
  "Assumptions": "Assumptions:\n- M365 Copilot access logs are ingested via Splunk Add-on for Microsoft Office 365\n- Azure AD Sign-in logs include location information\n- Normal users access from limited geographic locations\n\nPotential Impact:\n- Account compromise with distributed access\n- Credential sharing across locations\n- Impossible travel indicating stolen credentials",
  "origin": "custom",
  "Detection Name": "M365 Copilot Session Origin Anomalies",
  "Objective": "Detect and alert on M365 Copilot users accessing from multiple geographic locations indicating potential account compromise or credential sharing.",
  "Severity/Priority": "Low",
  "Analyst Next Steps": "1. Review the geographic locations and timestamps for impossible travel\n2. Check if user travels frequently for business\n3. Verify if VPN or proxy usage could explain multiple locations\n4. Contact user to confirm if access patterns are legitimate\n5. Consider forcing password reset if compromise is suspected",
  "Blind_Spots_False_Positives": "Blind Spots:\n- VPN usage masking true geographic location\n- Mobile users with frequently changing IPs\n- Proxy servers aggregating multiple user locations\n\nFalse Positives:\n- Legitimate business travelers, remote workers using VPNs, users with corporate offices in multiple locations, or employees accessing Copilot during international travel may trigger false positives.",
  "Required_Data_Sources": "M365 Copilot Graph API",
  "First Created": "2025-09-24T00:00:00.000Z",
  "Last Modified": "2026-01-22T00:00:00.000Z",
  "Search String": "`m365_copilot_graph_api` (appDisplayName=\"*Copilot*\" OR appDisplayName=\"M365ChatClient\" OR appDisplayName=\"OfficeAIAppChatCopilot\") | eval user = userPrincipalName | stats count as events, dc(location.city) as cities_count, values(location.city) as city_list, dc(location.countryOrRegion) as countries_count, values(location.countryOrRegion) as country_list, dc(ipAddress) as ip_count, values(ipAddress) as ip_addresses, min(_time) as first_seen, max(_time) as last_seen by user | eval days_active = round((last_seen - first_seen)/86400, 1) | eval locations_per_day = if(days_active > 0, round(cities_count/days_active, 2), cities_count) | eval first_seen = strftime(first_seen, \"%Y-%m-%d %H:%M:%S\") | eval last_seen = strftime(last_seen, \"%Y-%m-%d %H:%M:%S\") | where cities_count > 1 | sort -countries_count, -cities_count | `m365_copilot_session_origin_anomalies_filter`",
  "Splunk_App_Context": "search",
  "Search_Duration": "-24h",
  "Cron Schedule": "0 * * * *",
  "Schedule Window": "5",
  "Schedule Priority": "default",
  "Trigger Condition": "Number of results is greater than 0",
  "Throttling": {
    "enabled": 1,
    "fields": "user",
    "period": "1h"
  },
  "Risk": [
    {
      "risk_object_field": "user",
      "risk_object_type": "user",
      "risk_score": 10
    }
  ],
  "Notable Title": "M365 Copilot Session Origin Anomaly Detected for $user$",
  "Notable Description": "User $user$ accessed M365 Copilot from multiple geographic locations, indicating potential account compromise or credential sharing.",
  "Security Domain": "access",
  "Drilldown Name (Legacy)": "View Events Associated to this Notable on Access",
  "Drilldown Search (Legacy)": "`m365_copilot_graph_api` userPrincipalName=\"$user$\" | table _time userPrincipalName location.city location.countryOrRegion ipAddress",
  "Drilldown Earliest Offset (Legacy)": "2592000",
  "Drilldown Latest Offset (Legacy)": "86400",
  "Mitre ID": [
    "T1078"
  ],
  "Drilldown Name 1": "View the detection results for '$user$'",
  "Drilldown Search 1": "%original_detection_search% | search user=\"$user$\"",
  "Drilldown Earliest 1": "$info_min_time$",
  "Drilldown Latest 1": "$info_max_time$",
  "Drilldown Name 2": "View risk events for the last 7 days for \"$user$\"",
  "Drilldown Search 2": "| from datamodel Risk.All_Risk | search normalized_risk_object=\"$user\" | where _time >= relative_time(now(), \"-168h@h\") | stats count min(_time) as firstTime max(_time) as lastTime values(search_name) as \"Search Name\" values(risk_message) as \"Risk Message\" values(analyticstories) as \"Analytic Stories\" values(annotations._all) as \"Annotations\" values(annotations.mitre_attack.mitre_tactic) as \"ATT&CK Tactics\" by normalized_risk_object | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`",
  "Drilldown Earliest 2": "$info_min_time$",
  "Drilldown Latest 2": "$info_max_time$",
  "Drilldown Name 3": "",
  "Drilldown Search 3": "",
  "Drilldown Earliest 3": null,
  "Drilldown Latest 3": null,
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null,
  "Proposed Test Plan": ""
}