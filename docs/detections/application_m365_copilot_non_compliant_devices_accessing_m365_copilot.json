{
  "schema_version": "1.2",
  "file_name": "application_m365_copilot_non_compliant_devices_accessing_m365_copilot.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "",
      "Title": ""
    }
  ],
  "Description": "Detects M365 Copilot access from non-compliant or unmanaged devices that violate corporate security policies, indicating potential shadow IT usage, BYOD policy violations, or compromised endpoint access. The detection filters M365 Copilot Graph API events where deviceDetail.isCompliant=false or deviceDetail.isManaged=false, then aggregates by user, operating system, and browser to calculate metrics including event counts, unique IPs and locations, and compliance/management status over time. Users accessing Copilot from non-compliant or unmanaged devices are flagged and sorted by activity volume and geographic spread, enabling security teams to identify unauthorized endpoints that may lack proper security controls, encryption, or MDM enrollment.",
  "Assumptions": "Assumptions:\n- M365 Copilot access logs are ingested via Splunk Add-on for Microsoft Office 365\n- Azure AD Sign-in logs include device compliance information\n- Corporate devices are enrolled in MDM with compliance policies\n\nPotential Impact:\n- Shadow IT usage on unmanaged devices\n- BYOD policy violations\n- Data exposure from non-compliant endpoints",
  "origin": "custom",
  "Detection Name": "M365 Copilot Non Compliant Devices Accessing M365 Copilot",
  "Objective": "Detect and alert on M365 Copilot access from non-compliant or unmanaged devices that violate corporate security policies.",
  "Severity/Priority": "Medium",
  "Analyst Next Steps": "1. Identify the non-compliant or unmanaged device details\n2. Check if user is authorized for BYOD access\n3. Verify device compliance status in MDM console\n4. Contact user to remediate device compliance issues\n5. Consider blocking access until device meets compliance requirements",
  "Blind_Spots_False_Positives": "Blind Spots:\n- Devices not reporting compliance status\n- New devices pending MDM enrollment\n- VPN connections masking device details\n\nFalse Positives:\n- Legitimate employees using personal devices during emergencies, new hires awaiting device provisioning, temporary workers with unmanaged equipment, or users accessing Copilot from approved but temporarily non-compliant devices may trigger false positives.",
  "Required_Data_Sources": "M365 Copilot Graph API",
  "First Created": "2025-09-24T00:00:00.000Z",
  "Last Modified": "2026-01-22T00:00:00.000Z",
  "Search String": "`m365_copilot_graph_api` (appDisplayName=\"*Copilot*\" OR appDisplayName=\"M365ChatClient\") deviceDetail.isCompliant=false OR deviceDetail.isManaged=false | eval user = userPrincipalName | stats count as events, dc(ipAddress) as unique_ips, values(ipAddress) as ip_addresses, dc(location.city) as unique_cities, values(location.city) as cities, dc(location.countryOrRegion) as unique_countries, values(location.countryOrRegion) as countries, values(deviceDetail.isCompliant) as compliance_status, values(deviceDetail.isManaged) as management_status, min(_time) as first_seen, max(_time) as last_seen by user, deviceDetail.operatingSystem, deviceDetail.browser | eval days_active = round((last_seen - first_seen)/86400, 1) | eval first_seen = strftime(first_seen, \"%Y-%m-%d %H:%M:%S\") | eval last_seen = strftime(last_seen, \"%Y-%m-%d %H:%M:%S\") | sort -events, -unique_countries | `m365_copilot_non_compliant_devices_accessing_m365_copilot_filter`",
  "Splunk_App_Context": "search",
  "Search_Duration": "-24h",
  "Cron Schedule": "0 * * * *",
  "Schedule Window": "5",
  "Schedule Priority": "default",
  "Trigger Condition": "Number of results is greater than 0",
  "Throttling": {
    "enabled": 1,
    "fields": "user",
    "period": "1h"
  },
  "Risk": [
    {
      "risk_object_field": "user",
      "risk_object_type": "user",
      "risk_score": 50
    }
  ],
  "Notable Title": "M365 Copilot Access from Non-Compliant Device Detected for $user$",
  "Notable Description": "User $user$ accessed M365 Copilot from non-compliant or unmanaged devices across $unique_countries$ countries, violating corporate security policies and creating potential data exposure risks.",
  "Security Domain": "endpoint",
  "Drilldown Name (Legacy)": "View Events Associated to this Notable on Endpoint",
  "Drilldown Search (Legacy)": "`m365_copilot_graph_api` userPrincipalName=\"$user$\" | table _time userPrincipalName deviceDetail.operatingSystem deviceDetail.browser deviceDetail.isCompliant deviceDetail.isManaged",
  "Drilldown Earliest Offset (Legacy)": "2592000",
  "Drilldown Latest Offset (Legacy)": "86400",
  "Mitre ID": [
    "T1562"
  ],
  "Drilldown Name 1": "View the detection results for \"$user$\"",
  "Drilldown Search 1": "%original_detection_search% | search  \"$user = \"$user$\"",
  "Drilldown Earliest 1": "$info_min_time$",
  "Drilldown Latest 1": "$info_max_time$",
  "Drilldown Name 2": "View risk events for the last 7 days for \"$user$\"",
  "Drilldown Search 2": "| from datamodel Risk.All_Risk | search normalized_risk_object IN (\"$user$\", starthoursago=168  | stats count min(_time) as firstTime max(_time) as lastTime values(search_name) as \"Search Name\" values(risk_message) as \"Risk Message\" values(analyticstories) as \"Analytic Stories\" values(annotations._all) as \"Annotations\" values(annotations.mitre_attack.mitre_tactic) as \"ATT&CK Tactics\" by normalized_risk_object | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`",
  "Drilldown Earliest 2": "$info_min_time$",
  "Drilldown Latest 2": "$info_max_time$",
  "Drilldown Name 3": "",
  "Drilldown Search 3": "",
  "Drilldown Earliest 3": null,
  "Drilldown Latest 3": null,
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null,
  "Proposed Test Plan": ""
}