{
  "schema_version": "1.2",
  "file_name": "network_windows_spearphishing_attachment_connect_to_none_ms_office_domain.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "Teoderick Contreras, Splunk",
      "Title": ""
    }
  ],
  "Description": "The following analytic identifies suspicious Office documents that connect to non-Microsoft Office domains. It leverages Sysmon EventCode 22 to detect processes like winword.exe or excel.exe making DNS queries to domains outside of *.office.com or *.office.net. This activity is significant as it may indicate a spearphishing attempt using malicious documents to download or connect to harmful content. If confirmed malicious, this could lead to unauthorized data access, malware infection, or further network compromise.",
  "Assumptions": "Assumptions:\nTo successfully implement this search, you need to be ingesting logs with the process name, parent process, and command-line executions from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.\n\nPotential Impact:\nHigh - Spearphishing with malicious documents could lead to malware infection and data compromise.",
  "origin": "custom",
  "Detection Name": "Windows Spearphishing Attachment Connect To None MS Office Domain",
  "Objective": "Detect Office applications connecting to non-Microsoft domains that may indicate spearphishing with malicious documents.",
  "Severity/Priority": "medium",
  "Analyst Next Steps": "1. Investigate the Office document that triggered the alert.\n2. Examine the destination domain for malicious indicators.\n3. Check if the user received a suspicious email with an attachment.\n4. Isolate the endpoint if malware is confirmed.",
  "Blind_Spots_False_Positives": "Known False Positives: Windows Office document may contain legitimate url link other than MS office Domain. filter is needed.",
  "Required_Data_Sources": "Sysmon EventID 22",
  "First Created": "2022-09-19T00:00:00.000Z",
  "Last Modified": "2025-05-02T00:00:00.000Z",
  "Search String": "`sysmon` EventCode=22 Image IN (\"*\\\\winword.exe\",\"*\\\\excel.exe\",\"*\\\\powerpnt.exe\",\"*\\\\mspub.exe\",\"*\\\\visio.exe\",\"*\\\\wordpad.exe\",\"*\\\\wordview.exe\",\"*\\\\onenote.exe\", \"*\\\\onenotem.exe\",\"*\\\\onenoteviewer.exe\",\"*\\\\onenoteim.exe\", \"*\\\\msaccess.exe\") AND NOT(QueryName IN (\"*.office.com\", \"*.office.net\")) | stats count min(_time) as firstTime max(_time) as lastTime by answer answer_count dvc process_exec process_guid process_name query query_count reply_code_id signature signature_id src user_id vendor_product QueryName QueryResults QueryStatus | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_spearphishing_attachment_connect_to_none_ms_office_domain_filter`",
  "Splunk_App_Context": "",
  "Search_Duration": "",
  "Cron Schedule": "",
  "Schedule Window": "",
  "Schedule Priority": "default",
  "Trigger Condition": "",
  "Throttling": {
    "enabled": 0,
    "fields": "",
    "period": ""
  },
  "Risk": [
    {
      "risk_object_field": "dvc",
      "risk_object_type": "system",
      "risk_score": 49
    }
  ],
  "Notable Title": "Windows Spearphishing Attachment Connect To None MS Office Domain",
  "Notable Description": "Suspicious Office document connecting to non-Microsoft domain detected",
  "Security Domain": "endpoint",
  "Drilldown Name (Legacy)": "View Events Associated to this Notable on ",
  "Drilldown Search (Legacy)": "",
  "Drilldown Earliest Offset (Legacy)": "2592000",
  "Drilldown Latest Offset (Legacy)": "86400",
  "Mitre ID": [
    "T1566.001"
  ],
  "Drilldown Name 1": "",
  "Drilldown Search 1": "",
  "Drilldown Earliest 1": null,
  "Drilldown Latest 1": null,
  "Drilldown Name 2": "",
  "Drilldown Search 2": "",
  "Drilldown Earliest 2": null,
  "Drilldown Latest 2": null,
  "Drilldown Name 3": "",
  "Drilldown Search 3": "",
  "Drilldown Earliest 3": null,
  "Drilldown Latest 3": null,
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null,
  "Proposed Test Plan": ""
}