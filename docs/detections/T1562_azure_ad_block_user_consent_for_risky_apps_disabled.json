{
  "schema_version": "1.2",
  "file_name": "T1562_azure_ad_block_user_consent_for_risky_apps_disabled.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "",
      "Title": ""
    }
  ],
  "Description": "The following analytic detects when the risk-based step-up consent security setting in Azure AD is disabled. It monitors Azure Active Directory logs for the \"Update authorization policy\" operation, specifically changes to the \"AllowUserConsentForRiskyApps\" setting. This activity is significant because disabling this feature can expose the organization to OAuth phishing threats by allowing users to grant consent to potentially malicious applications. If confirmed malicious, attackers could gain unauthorized access to user data and sensitive information, leading to data breaches and further compromise within the organization.",
  "Assumptions": "Assumptions:\n- Azure AD AuditLogs are being ingested via EventHub\n- Splunk Add-on for Microsoft Cloud Services is installed\n- Authorization policy changes are being logged\n\nPotential Impact:\n- Exposure to OAuth phishing attacks\n- Users able to consent to risky applications\n- Potential data breaches through malicious app consent",
  "origin": "custom",
  "Detection Name": "Azure AD Block User Consent For Risky Apps Disabled",
  "Objective": "Detect and alert when the BlockUserConsentForRiskyApps setting is disabled, which increases exposure to OAuth phishing threats.",
  "Severity/Priority": "Medium",
  "Analyst Next Steps": "1. Identify who made the authorization policy change\n2. Verify if the change was authorized and documented\n3. Review any consent grants that occurred after the policy change\n4. Consider re-enabling the risk-based consent feature\n5. Check for any suspicious OAuth application consent activity",
  "Blind_Spots_False_Positives": "Blind Spots:\n- Policy changes made through methods not captured in audit logs\n- Changes at the application level rather than tenant level\n\nFalse Positives:\n- Legitimate changes to the 'risk-based step-up consent' setting by administrators, perhaps as part of a policy update or security assessment, may trigger this alert, necessitating verification of the change's intent and authorization",
  "Required_Data_Sources": "Azure Active Directory AuditLogs",
  "First Created": "2025-05-02T00:00:00.000Z",
  "Last Modified": "2026-01-22T00:00:00.000Z",
  "Search String": "`azure_monitor_aad` operationName=\"Update authorization policy\" | rename properties.* as * | eval index_number = if(mvfind('targetResources{}.modifiedProperties{}.displayName',\"AllowUserConsentForRiskyApps\") >= 0, mvfind('targetResources{}.modifiedProperties{}.displayName',\"AllowUserConsentForRiskyApps\"), -1) | search index_number >= 0 | eval AllowUserConsentForRiskyApps = mvindex('targetResources{}.modifiedProperties{}.newValue',index_number) | search AllowUserConsentForRiskyApps = \"[true]\" | rename userAgent as user_agent | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by dest user src vendor_account vendor_product user_agent signature | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `azure_ad_block_user_consent_for_risky_apps_disabled_filter`",
  "Splunk_App_Context": "search",
  "Search_Duration": "-15m",
  "Cron Schedule": "*/15 * * * *",
  "Schedule Window": "5",
  "Schedule Priority": "default",
  "Trigger Condition": "Number of results is greater than 0",
  "Throttling": {
    "enabled": 1,
    "fields": "user",
    "period": "1h"
  },
  "Risk": [
    {
      "risk_object_field": "user",
      "risk_object_type": "user",
      "risk_score": 30
    }
  ],
  "Notable Title": "Azure AD Block User Consent For Risky Apps Disabled by $user$",
  "Notable Description": "User $user$ disabled the BlockUserConsentForRiskyApps Azure AD setting.",
  "Security Domain": "identity",
  "Drilldown Name (Legacy)": "View Events Associated to this Notable on Identity",
  "Drilldown Search (Legacy)": "`azure_monitor_aad` operationName=\"Update authorization policy\" user=\"$user$\" | table _time user dest signature",
  "Drilldown Earliest Offset (Legacy)": "2592000",
  "Drilldown Latest Offset (Legacy)": "86400",
  "Mitre ID": [
    "T1562"
  ],
  "Drilldown Name 1": "View the detection results for - \"$user$\"",
  "Drilldown Search 1": "%original_detection_search% | search  user = \"$user$\"",
  "Drilldown Earliest 1": "$info_min_time$",
  "Drilldown Latest 1": "$info_max_time$",
  "Drilldown Name 2": "View risk events for the last 7 days for - \"$user$\"",
  "Drilldown Search 2": "| from datamodel Risk.All_Risk | search normalized_risk_object IN (\"$user$\") starthoursago=168  | stats count min(_time) as firstTime max(_time) as lastTime values(search_name) as \"Search Name\" values(risk_message) as \"Risk Message\" values(analyticstories) as \"Analytic Stories\" values(annotations._all) as \"Annotations\" values(annotations.mitre_attack.mitre_tactic) as \"ATT&CK Tactics\" by normalized_risk_object | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`",
  "Drilldown Earliest 2": "$info_min_time$",
  "Drilldown Latest 2": "$info_max_time$",
  "Drilldown Name 3": "",
  "Drilldown Search 3": "",
  "Drilldown Earliest 3": null,
  "Drilldown Latest 3": null,
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null,
  "Proposed Test Plan": ""
}