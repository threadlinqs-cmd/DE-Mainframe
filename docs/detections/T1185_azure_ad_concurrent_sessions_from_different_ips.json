{
  "schema_version": "1.2",
  "file_name": "T1185_azure_ad_concurrent_sessions_from_different_ips.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "",
      "Title": ""
    }
  ],
  "Description": "The following analytic detects an Azure AD account with concurrent sessions originating from multiple unique IP addresses within a 5-minute window. It leverages Azure Active Directory NonInteractiveUserSignInLogs to identify this behavior by analyzing successful authentication events and counting distinct source IPs. This activity is significant as it may indicate session hijacking, where an attacker uses stolen session cookies to access corporate resources from a different location. If confirmed malicious, this could lead to unauthorized access to sensitive information and potential data breaches.",
  "Assumptions": "Assumptions:\n- Azure AD NonInteractiveUserSignInLogs are being ingested via EventHub\n- Splunk Add-on for Microsoft Cloud Services is installed\n- Users typically authenticate from a single IP at a time\n\nPotential Impact:\n- Session hijacking and token theft\n- Unauthorized access from multiple locations\n- Potential data breaches and account compromise",
  "origin": "custom",
  "Detection Name": "Azure AD Concurrent Sessions From Different Ips",
  "Objective": "Detect and alert on users with concurrent sessions from multiple IP addresses, which may indicate session hijacking or credential theft.",
  "Severity/Priority": "Medium",
  "Analyst Next Steps": "1. Review the source IPs associated with the concurrent sessions\n2. Check geolocation of the IPs for impossible travel scenarios\n3. Verify with the user if they are using multiple devices or VPNs\n4. Look for signs of token theft or session hijacking\n5. Consider revoking active sessions if malicious activity is confirmed",
  "Blind_Spots_False_Positives": "Blind Spots:\n- Sessions not captured in NonInteractiveUserSignInLogs\n- VPN or proxy usage that masks true IP addresses\n\nFalse Positives:\n- A user with concurrent sessions from different IPs may also represent the legitimate use of more than one device. Filter as needed and/or customize the threshold to fit your environment. Also consider the geographic location of the IP addresses and filter out IP space that belong to your organization.",
  "Required_Data_Sources": "Azure Active Directory NonInteractiveUserSignInLogs",
  "First Created": "2025-10-14T00:00:00.000Z",
  "Last Modified": "2026-01-22T00:00:00.000Z",
  "Search String": "`azure_monitor_aad` properties.authenticationDetails{}.succeeded=true category=NonInteractiveUserSignInLogs action=success | rename properties.* as * | bucket span=5m _time | rename userAgent as user_agent | fillnull | stats count min(_time) as firstTime max(_time) as lastTime dc(src) as unique_ips values(dest) as dest values(src) as src values(user_agent) as user_agent by user _time vendor_account vendor_product category | where unique_ips > 1 | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `azure_ad_concurrent_sessions_from_different_ips_filter`",
  "Splunk_App_Context": "search",
  "Search_Duration": "-15m",
  "Cron Schedule": "*/15 * * * *",
  "Schedule Window": "5",
  "Schedule Priority": "default",
  "Trigger Condition": "Number of results is greater than 0",
  "Throttling": {
    "enabled": 1,
    "fields": "user",
    "period": "1h"
  },
  "Risk": [
    {
      "risk_object_field": "user",
      "risk_object_type": "user",
      "risk_score": 42
    }
  ],
  "Notable Title": "Azure AD Concurrent Sessions from Different IPs Detected for $user$",
  "Notable Description": "User $user$ has concurrent sessions from more than one unique IP address in the span of 5 minutes.",
  "Security Domain": "threat",
  "Drilldown Name (Legacy)": "View Events Associated to this Notable on Threat",
  "Drilldown Search (Legacy)": "`azure_monitor_aad` category=NonInteractiveUserSignInLogs user=\"$user$\" | table _time user src dest user_agent",
  "Drilldown Earliest Offset (Legacy)": "2592000",
  "Drilldown Latest Offset (Legacy)": "86400",
  "Mitre ID": [
    "T1185"
  ],
  "Drilldown Name 1": "View the detection results for - \"$user$\"",
  "Drilldown Search 1": "%original_detection_search% | search  user = \"$user$\"",
  "Drilldown Earliest 1": "$info_min_time$",
  "Drilldown Latest 1": "$info_max_time$",
  "Drilldown Name 2": "View risk events for the last 7 days for - \"$user$\"",
  "Drilldown Search 2": "| from datamodel Risk.All_Risk | search normalized_risk_object IN (\"$user$\") starthoursago=168  | stats count min(_time) as firstTime max(_time) as lastTime values(search_name) as \"Search Name\" values(risk_message) as \"Risk Message\" values(analyticstories) as \"Analytic Stories\" values(annotations._all) as \"Annotations\" values(annotations.mitre_attack.mitre_tactic) as \"ATT&CK Tactics\" by normalized_risk_object | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`",
  "Drilldown Earliest 2": "$info_min_time$",
  "Drilldown Latest 2": "$info_max_time$",
  "Drilldown Name 3": "",
  "Drilldown Search 3": "",
  "Drilldown Earliest 3": null,
  "Drilldown Latest 3": null,
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null,
  "Proposed Test Plan": ""
}