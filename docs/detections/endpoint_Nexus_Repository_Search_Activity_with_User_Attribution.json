{
  "schema_version": "1.2",
  "file_name": "endpoint_Nexus_Repository_Search_Activity_with_User_Attribution.json",
  "Roles": [
    {
      "Role": "Requestor",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Business Owner",
      "Name": "",
      "Title": ""
    },
    {
      "Role": "Technical Owner",
      "Name": "",
      "Title": ""
    }
  ],
  "Description": "Detects users performing browse/search operations on the Nexus artifact repository and correlates the source IP with Cisco ASA authentication logs to attribute activity to a specific user and hostname. This detection supports identification of reconnaissance activity where adversaries or malicious insiders search for sensitive packages, internal tools, or dependencies that could be targeted for supply chain attacks or intellectual property theft. The detection decodes URL-encoded search parameters to extract the actual search terms and uses a 30-minute time window correlation with Cisco ASA to attribute the network activity to a specific user identity and asset owner.",
  "Assumptions": "Assumptions:\n\nPotential Impact:",
  "origin": "custom",
  "Detection Name": "Nexus Repository Search Activity with User Attribution",
  "Objective": "Detect and attribute Nexus repository search activity to specific users and hosts for insider threat detection, supply chain security monitoring, and identification of reconnaissance activity targeting internal software artifacts.",
  "Severity/Priority": "high",
  "Analyst Next Steps": "1. Identify the attributed user by reviewing the 'owner' and 'hostname' fields - if attribution is missing (null values), manually query Cisco ASA logs for the src_ip within the window_start and window_end timeframe to establish identity.\n2. Analyze the 'searched_terms' field for suspicious patterns including: keywords related to sensitive projects, security tools, credentials, internal codenames, or reconnaissance indicators such as 'password', 'secret', 'key', 'admin', 'internal', 'config', or 'credential'.\n3. Establish a behavioral baseline by querying historical Nexus search activity for this user - determine if repository searches are part of their normal job function and compare current search volume against their typical patterns.\n4. Review the 'user_agents' field to identify the tool used for searching - look for automation indicators such as curl, wget, python-requests, or custom scripts that may indicate programmatic enumeration rather than manual browsing.\n5. Check for subsequent artifact downloads by querying Nexus logs for the same src_ip with download actions following the search activity - correlate searched terms with any packages that were actually retrieved.\n6. Investigate the user's endpoint activity using the comprehensive drilldown search to examine process executions, file operations (especially archive creation), and network connections occurring around the same timeframe.\n7. Query DLP and proxy logs for the hostname/src_ip to identify any data exfiltration attempts or transfers to external storage services (Dropbox, OneDrive, GitHub, personal email) following the Nexus activity.\n8. Verify business justification by checking ticketing systems (ServiceNow, Jira) for any work items assigned to this user that would require searching the artifact repository - contact their manager if no legitimate purpose is apparent.\n9. Assess scope by searching for similar Nexus search patterns from other users that may indicate coordinated reconnaissance or a broader campaign targeting specific packages or projects.\n10. If malicious intent is suspected, preserve evidence by capturing full Nexus audit logs, ASA session logs, and endpoint forensic data before taking containment actions.",
  "Blind_Spots_False_Positives": "BLIND SPOTS: API-based searches bypassing the web UI search endpoint pattern; Direct artifact downloads without prior search activity; Users accessing Nexus from IPs not captured by Cisco ASA (e.g., direct internal network access); Searches during expired VPN/ASA sessions preventing user attribution; Alternative URL patterns for searches not matching the current regex. FALSE POSITIVES: Developers legitimately searching for packages during normal development workflows; Build systems or CI/CD pipelines querying Nexus for dependency resolution; Operations teams performing routine repository maintenance or audits; Security teams conducting authorized vulnerability scans; New employees exploring available internal packages as part of onboarding.",
  "Required_Data_Sources": "Nexus Repository Manager request logs (index=nexus, sourcetype=nexus:request_log), Cisco ASA firewall authentication logs (index=cisco, sourcetype=cisco:asa), Asset inventory lookup (asset_lookup_by_str)",
  "First Created": "2026-01-27T19:52:46.000Z",
  "Last Modified": "2026-01-28T16:40:40.010Z",
  "Search String": "index=\"nexus\" sourcetype=\"nexus:request_log\" ha=\"*%23browse%2Fsearch%2Fgeneric%3D*\"\n| eval ha_fixed = replace(ha,\"&amp;\",\"&\")\n| eval ha_decoded = urldecode(ha_fixed)\n| rex field=ha_decoded \"(?i)#browse/search/generic=(?<search_q>[^&]+)\"\n| eval search_q = lower(urldecode(search_q))\n| bin _time span=1m\n| stats count as searches dc(search_q) as uniq_terms values(search_q) as searched_terms values(status) as statuses values(user_agent) as user_agents values(ha_decoded) as decoded_search by _time host src_ip\n| eval window_start=_time-1800, window_end=_time+1800\n| join type=left src_ip [search index=cisco sourcetype=cisco:asa | where isnotnull(src_ip) AND isnotnull(Cisco_ASA_user) | eval cisco_time = _time | rex field=Cisco_ASA_user \"(?<hostname>[A-Za-z0-9\\\\-]*)\\\\$@bocad.bank-banque-canada.ca\" | eval hostname = lower(hostname) + \".bocad.bank-banque-canada.ca\" | lookup asset_lookup_by_str dns as hostname OUTPUTNEW owner | stats values(hostname) as hostname values(owner) as owner latest(Cisco_ASA_user) as asa_user latest(cisco_time) as cisco_match_time by src_ip]\n| where isnull(cisco_time) OR (cisco_time>=window_start AND cisco_time<=window_end)\n| stats values(hostname) as hostname values(owner) as owner sum(searches) as searches max(uniq_terms) as uniq_terms values(searched_terms) as searched_terms values(statuses) as statuses values(user_agents) as user_agents values(decoded_search) as decoded_search earliest(window_start) as window_start latest(window_end) as window_end earliest(cisco_time) as first_cisco_time latest(cisco_time) as last_cisco_time by _time host src_ip\n| eval window_start=strftime(window_start,\"%Y-%m-%d %H:%M:%S\"), window_end=strftime(window_end,\"%Y-%m-%d %H:%M:%S\"), first_cisco_time=strftime(first_cisco_time,\"%Y-%m-%d %H:%M:%S\"), last_cisco_time=strftime(last_cisco_time,\"%Y-%m-%d %H:%M:%S\")\n| sort - _time",
  "Splunk_App_Context": "",
  "Search_Duration": "",
  "Cron Schedule": "*/15 * * * *",
  "Schedule Window": "5",
  "Schedule Priority": "",
  "Trigger Condition": "Number of results is greater than 0",
  "Throttling": {
    "enabled": 1,
    "fields": "src_ip,owner",
    "period": "1h"
  },
  "Risk": [
    {
      "risk_object_field": "owner",
      "risk_object_type": "user",
      "risk_score": 75
    },
    {
      "risk_object_field": "hostname",
      "risk_object_type": "system",
      "risk_score": 75
    }
  ],
  "Notable Title": "Nexus Repository Search Activity - $owner$ from $hostname$ ($src_ip$)",
  "Notable Description": "User $owner$ performed $searches$ searches on the Nexus repository from $hostname$ ($src_ip$). Search terms included: $searched_terms$. This activity may indicate reconnaissance for supply chain targeting, intellectual property theft, or insider threat activity. User attribution was correlated via Cisco ASA authentication logs within a 30-minute time window.",
  "Security Domain": "endpoint",
  "Drilldown Name (Legacy)": "",
  "Drilldown Search (Legacy)": "",
  "Drilldown Earliest Offset (Legacy)": null,
  "Drilldown Latest Offset (Legacy)": null,
  "Mitre ID": [
    "T1213",
    "T1526",
    "T1195.001",
    "T1195"
  ],
  "Proposed Test Plan": "VALIDATION STEPS: 1) Perform a manual Nexus browse search via the web UI and verify the detection triggers with correct field extraction. 2) Confirm ASA correlation by searching from a VPN-connected workstation and verifying owner/hostname attribution. 3) Test URL decoding by searching for terms with special characters and spaces. 4) Verify the 30-minute correlation window by testing searches at the edge of VPN session timing. 5) Test drilldown searches by clicking through from a triggered alert and confirming all data sources return relevant context.",
  "Drilldown Name 1": "View Events Associated to this Notable on",
  "Drilldown Search 1": "",
  "Drilldown Earliest 1": "2592000",
  "Drilldown Latest 1": "86400",
  "Drilldown Name 2": "Comprehensive Investigation - Nexus User Activity and Endpoint Correlation",
  "Drilldown Search 2": "index=nexus sourcetype=\"nexus:request_log\" src_ip=\"$src_ip$\"\n    OR (index=cisco sourcetype=cisco:asa src_ip=\"$src_ip$\")\n    OR (index=azure_cloud sourcetype=\"mscs:azure:eventhub:defender\" properties.DeviceName=\"$hostname$\")\n\n| eval ha_fixed = replace(ha,\"&amp;\",\"&\"), ha_decoded = urldecode(ha_fixed)\n| rex field=ha_decoded \"(?i)#browse/search/generic=(?<search_term>[^&]+)\"\n| eval search_term = lower(urldecode(search_term))\n| rex field=Cisco_ASA_user \"(?<asa_hostname>[A-Za-z0-9\\-]*)\\$@bocad.bank-banque-canada.ca\"\n\n| eval investigation_category=case(\n    sourcetype==\"nexus:request_log\" AND isnotnull(search_term), \"1_NEXUS_SEARCH_ACTIVITY\",\n    sourcetype==\"nexus:request_log\" AND match(uri_path, \"(?i)download|repository\"), \"2_NEXUS_DOWNLOAD_ACTIVITY\",\n    sourcetype==\"nexus:request_log\", \"3_NEXUS_OTHER_ACTIVITY\",\n    sourcetype==\"cisco:asa\" AND match(_raw, \"(?i)built|established\"), \"4_ASA_SESSION_ESTABLISHED\",\n    sourcetype==\"cisco:asa\" AND match(_raw, \"(?i)authentication|login\"), \"5_ASA_AUTHENTICATION\",\n    sourcetype==\"cisco:asa\", \"6_ASA_OTHER_NETWORK\",\n    match('properties.ActionType', \"(?i)ProcessCreated\") AND match('properties.FileName', \"(?i)(curl|wget|powershell|python|git|7z|zip|tar|rar)\"), \"7_ENDPOINT_SUSPICIOUS_PROCESS\",\n    match('properties.ActionType', \"(?i)ProcessCreated\"), \"8_ENDPOINT_PROCESS_EXECUTION\",\n    match('properties.ActionType', \"(?i)FileCreated|FileModified\") AND match('properties.FileName', \"(?i)\\.(zip|7z|rar|tar|gz)$\"), \"9_ENDPOINT_ARCHIVE_CREATED\",\n    match('properties.ActionType', \"(?i)FileCreated|FileModified\"), \"10_ENDPOINT_FILE_ACTIVITY\",\n    match('properties.ActionType', \"(?i)ConnectionSuccess|NetworkConnection\"), \"11_ENDPOINT_NETWORK_CONNECTION\",\n    1==1, \"99_OTHER\"\n)\n\n| eval key_indicator=case(\n    investigation_category==\"1_NEXUS_SEARCH_ACTIVITY\", \"Search: \".search_term.\" | Status: \".status,\n    investigation_category==\"2_NEXUS_DOWNLOAD_ACTIVITY\", \"Download: \".uri_path.\" | Status: \".status,\n    investigation_category==\"4_ASA_SESSION_ESTABLISHED\", \"Session: \".Cisco_ASA_user.\" -> \".dest_ip.\":\".dest_port,\n    investigation_category==\"5_ASA_AUTHENTICATION\", \"Auth: \".Cisco_ASA_user.\" from \".src_ip,\n    investigation_category==\"7_ENDPOINT_SUSPICIOUS_PROCESS\", \"SUSPICIOUS: \".'properties.FileName'.\" | Cmd: \".'properties.ProcessCommandLine',\n    investigation_category==\"8_ENDPOINT_PROCESS_EXECUTION\", 'properties.FileName'.\" | Parent: \".'properties.InitiatingProcessFileName',\n    investigation_category==\"9_ENDPOINT_ARCHIVE_CREATED\", \"Archive: \".'properties.FileName'.\" in \".'properties.FolderPath',\n    investigation_category==\"11_ENDPOINT_NETWORK_CONNECTION\", 'properties.InitiatingProcessFileName'.\" -> \".'properties.RemoteIP'.\":\".'properties.RemotePort',\n    1==1, coalesce(uri_path, 'properties.ActionType', action, \"Activity logged\")\n)\n\n| eval user_context=coalesce(owner, Cisco_ASA_user, 'properties.AccountName', \"Unknown\"),\n       device_context=coalesce(hostname, asa_hostname, 'properties.DeviceName', \"Unknown\"),\n       ioc_hash=coalesce('properties.SHA256', 'properties.SHA1', 'properties.InitiatingProcessSHA256', \"N/A\"),\n       remote_dest=coalesce('properties.RemoteIP', 'properties.RemoteUrl', dest_ip, \"N/A\")\n\n| stats\n    earliest(_time) as first_seen,\n    latest(_time) as last_seen,\n    count as event_count,\n    values(key_indicator) as indicators,\n    values(search_term) as search_terms,\n    values(user_context) as users,\n    values(device_context) as devices,\n    values(ioc_hash) as hashes,\n    values(remote_dest) as destinations,\n    values(user_agent) as user_agents,\n    dc(search_term) as unique_searches,\n    dc(remote_dest) as unique_destinations\n    by investigation_category\n\n| eval first_seen=strftime(first_seen, \"%Y-%m-%d %H:%M:%S\"),\n       last_seen=strftime(last_seen, \"%Y-%m-%d %H:%M:%S\")\n\n| sort investigation_category\n\n| rename\n    investigation_category as \"Investigation Category\",\n    first_seen as \"First Seen\",\n    last_seen as \"Last Seen\",\n    event_count as \"Event Count\",\n    indicators as \"Key Indicators\",\n    search_terms as \"Search Terms\",\n    users as \"Users\",\n    devices as \"Devices\",\n    hashes as \"File Hashes (IOCs)\",\n    destinations as \"Remote Destinations\",\n    user_agents as \"User Agents\",\n    unique_searches as \"Unique Searches\",\n    unique_destinations as \"Unique Destinations\"",
  "Drilldown Earliest 2": "-7d",
  "Drilldown Latest 2": "now",
  "Drilldown Name 3": "Cross-Source Timeline - User Activity Sequence Analysis",
  "Drilldown Search 3": "index=nexus sourcetype=\"nexus:request_log\" src_ip=\"$src_ip$\"\n    OR (index=cisco sourcetype=cisco:asa (src_ip=\"$src_ip$\" OR Cisco_ASA_user=\"*$owner$*\"))\n    OR (index=proxy sourcetype=bluecoat OR index=proxy sourcetype=zscaler src_ip=\"$src_ip$\")\n    OR (index=dlp src_ip=\"$src_ip$\" OR user=\"*$owner$*\")\n\n| eval ha_fixed = replace(ha,\"&amp;\",\"&\"), ha_decoded = urldecode(ha_fixed)\n| rex field=ha_decoded \"(?i)#browse/search/generic=(?<search_term>[^&]+)\"\n| eval search_term = lower(urldecode(search_term))\n\n| eval activity_category=case(\n    sourcetype==\"nexus:request_log\" AND isnotnull(search_term), \"1_RECON_SEARCH\",\n    sourcetype==\"nexus:request_log\" AND match(uri_path, \"(?i)download\"), \"2_ARTIFACT_DOWNLOAD\",\n    sourcetype==\"nexus:request_log\", \"3_NEXUS_BROWSE\",\n    sourcetype==\"cisco:asa\" AND match(_raw, \"(?i)authentication\"), \"4_NETWORK_AUTH\",\n    sourcetype==\"cisco:asa\", \"5_NETWORK_SESSION\",\n    match(sourcetype, \"(?i)bluecoat|zscaler\") AND match(url, \"(?i)(github|gitlab|dropbox|drive\\.google|onedrive|mega|transfer\\.sh|pastebin)\"), \"6_CLOUD_STORAGE_ACCESS\",\n    match(sourcetype, \"(?i)bluecoat|zscaler\"), \"7_WEB_BROWSING\",\n    index==\"dlp\" AND match(action, \"(?i)block\"), \"8_DLP_BLOCKED\",\n    index==\"dlp\", \"9_DLP_ALERT\",\n    1==1, \"99_OTHER_ACTIVITY\"\n)\n\n| eval risk_indicator=case(\n    activity_category==\"1_RECON_SEARCH\" AND match(search_term, \"(?i)(password|secret|key|credential|admin|internal|config|token|private)\"), \"HIGH - Sensitive Term Search\",\n    activity_category==\"2_ARTIFACT_DOWNLOAD\", \"MEDIUM - Artifact Retrieved\",\n    activity_category==\"6_CLOUD_STORAGE_ACCESS\", \"HIGH - External Storage Access\",\n    activity_category==\"8_DLP_BLOCKED\", \"CRITICAL - DLP Block Event\",\n    activity_category==\"9_DLP_ALERT\", \"HIGH - DLP Alert Triggered\",\n    1==1, \"LOW - Normal Activity\"\n)\n\n| eval activity_detail=case(\n    activity_category==\"1_RECON_SEARCH\", \"Searched: \".search_term,\n    activity_category==\"2_ARTIFACT_DOWNLOAD\", \"Downloaded: \".uri_path,\n    activity_category==\"4_NETWORK_AUTH\", \"VPN Auth: \".Cisco_ASA_user,\n    activity_category==\"6_CLOUD_STORAGE_ACCESS\", \"Cloud Access: \".url,\n    activity_category==\"8_DLP_BLOCKED\", \"DLP Blocked: \".file_name.\" Policy: \".policy_name,\n    1==1, coalesce(uri_path, url, action, \"Activity\")\n)\n\n| eval user_identity=coalesce(owner, Cisco_ASA_user, user, \"Unknown\"),\n       source_system=case(\n           sourcetype==\"nexus:request_log\", \"Nexus Repository\",\n           sourcetype==\"cisco:asa\", \"Cisco ASA\",\n           match(sourcetype, \"(?i)bluecoat|zscaler\"), \"Web Proxy\",\n           index==\"dlp\", \"DLP System\",\n           1==1, sourcetype\n       )\n\n| stats\n    earliest(_time) as first_seen,\n    latest(_time) as last_seen,\n    count as event_count,\n    values(activity_detail) as activities,\n    values(risk_indicator) as risk_indicators,\n    values(user_identity) as users,\n    values(src_ip) as source_ips,\n    dc(activity_detail) as unique_activities\n    by activity_category, source_system\n\n| eval first_seen=strftime(first_seen, \"%Y-%m-%d %H:%M:%S\"),\n       last_seen=strftime(last_seen, \"%Y-%m-%d %H:%M:%S\"),\n       priority_sort=case(\n           match(risk_indicators, \"CRITICAL\"), 1,\n           match(risk_indicators, \"HIGH\"), 2,\n           match(risk_indicators, \"MEDIUM\"), 3,\n           1==1, 4\n       )\n\n| sort priority_sort, activity_category\n\n| rename\n    activity_category as \"Activity Category\",\n    source_system as \"Data Source\",\n    first_seen as \"First Seen\",\n    last_seen as \"Last Seen\",\n    event_count as \"Event Count\",\n    activities as \"Activity Details\",\n    risk_indicators as \"Risk Level\",\n    users as \"User Identity\",\n    source_ips as \"Source IPs\",\n    unique_activities as \"Unique Activities\"\n\n| fields - priority_sort",
  "Drilldown Earliest 3": "-7d",
  "Drilldown Latest 3": "now",
  "Drilldown Name 4": "",
  "Drilldown Search 4": "",
  "Drilldown Earliest 4": null,
  "Drilldown Latest 4": null,
  "Drilldown Name 5": "",
  "Drilldown Search 5": "",
  "Drilldown Earliest 5": null,
  "Drilldown Latest 5": null,
  "Drilldown Name 6": "",
  "Drilldown Search 6": "",
  "Drilldown Earliest 6": null,
  "Drilldown Latest 6": null,
  "Drilldown Name 7": "",
  "Drilldown Search 7": "",
  "Drilldown Earliest 7": null,
  "Drilldown Latest 7": null,
  "Drilldown Name 8": "",
  "Drilldown Search 8": "",
  "Drilldown Earliest 8": null,
  "Drilldown Latest 8": null,
  "Drilldown Name 9": "",
  "Drilldown Search 9": "",
  "Drilldown Earliest 9": null,
  "Drilldown Latest 9": null,
  "Drilldown Name 10": "",
  "Drilldown Search 10": "",
  "Drilldown Earliest 10": null,
  "Drilldown Latest 10": null,
  "Drilldown Name 11": "",
  "Drilldown Search 11": "",
  "Drilldown Earliest 11": null,
  "Drilldown Latest 11": null,
  "Drilldown Name 12": "",
  "Drilldown Search 12": "",
  "Drilldown Earliest 12": null,
  "Drilldown Latest 12": null,
  "Drilldown Name 13": "",
  "Drilldown Search 13": "",
  "Drilldown Earliest 13": null,
  "Drilldown Latest 13": null,
  "Drilldown Name 14": "",
  "Drilldown Search 14": "",
  "Drilldown Earliest 14": null,
  "Drilldown Latest 14": null,
  "Drilldown Name 15": "",
  "Drilldown Search 15": "",
  "Drilldown Earliest 15": null,
  "Drilldown Latest 15": null
}