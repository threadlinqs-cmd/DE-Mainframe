<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DE-MainFrame</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Password Protection Modal -->
    <div id="modal-password" class="modal password-modal">
        <div class="modal-overlay no-close"></div>
        <div class="modal-content password-modal-content">
            <div class="modal-header">
                <div class="password-lock-icon">üîí</div>
                <h3>DE-MainFrame Access</h3>
            </div>
            <div class="modal-body">
                <p class="password-prompt">Enter password to continue</p>
                <div class="form-group">
                    <input type="password" id="password-input" class="password-input" placeholder="Password" autocomplete="off">
                </div>
                <p id="password-error" class="password-error hidden">Incorrect password</p>
            </div>
            <div class="modal-footer">
                <button id="btn-password-submit" class="btn-primary" onclick="validatePassword()">Unlock</button>
            </div>
        </div>
    </div>

    <div id="app">
        <!-- Sidebar Overlay (mobile) -->
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

        <!-- Collapsible Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <span class="sidebar-title">Navigation</span>
                <button class="sidebar-close" onclick="toggleSidebar()" aria-label="Close sidebar">√ó</button>
            </div>
            <nav class="sidebar-nav">
                <a href="#library" class="nav-item active" data-key="1">Library</a>
                <a href="#editor" class="nav-item" data-key="2">Editor</a>
                <a href="#macros" class="nav-item" data-key="3">Macros</a>
                <a href="#revalidation" class="nav-item" data-key="4">Revalidation</a>
                <a href="#history" class="nav-item" data-key="5">History</a>
                <a href="#resources" class="nav-item" data-key="6">Resources</a>
                <a href="#reports" class="nav-item" data-key="7">Reports</a>
                <a href="#settings" class="nav-item" data-key="8">Settings</a>
            </nav>
            <div class="sidebar-footer">
                <a href="../" class="nav-item nav-classic">‚Üê Classic UI</a>
            </div>
        </aside>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Header Bar -->
            <header class="header-bar">
                <div class="header-left">
                    <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Toggle menu">‚ò∞</button>
                    <h1 class="header-title">DE-MainFrame</h1>
                </div>
                <div class="header-right">
                    <span class="header-subtitle">Detection Engineering</span>
                    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme" title="Toggle light/dark theme">‚òÄ</button>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="content-area">
                <!-- Library View -->
                <section id="view-library" class="view active">
                    <div class="library-layout">
                        <!-- Sidebar - Filters + Detection List -->
                        <aside class="library-sidebar">
                            <div class="library-search">
                                <input type="text" id="library-search-input" class="search-input" placeholder="Search detections...">
                            </div>
                            <div class="library-filters">
                                <div class="filter-row">
                                    <select id="filter-severity" class="filter-select">
                                        <option value="">All Severities</option>
                                        <option value="critical">Critical</option>
                                        <option value="high">High</option>
                                        <option value="medium">Medium</option>
                                        <option value="low">Low</option>
                                        <option value="informational">Informational</option>
                                    </select>
                                    <select id="filter-status" class="filter-select">
                                        <option value="">All Status</option>
                                        <option value="valid">Valid</option>
                                        <option value="incomplete">Incomplete</option>
                                        <option value="needs-tune">Needs Tune</option>
                                        <option value="needs-retrofit">Needs Retrofit</option>
                                    </select>
                                </div>
                                <div class="filter-row">
                                    <select id="filter-domain" class="filter-select">
                                        <option value="">All Domains</option>
                                        <option value="access">Access</option>
                                        <option value="endpoint">Endpoint</option>
                                        <option value="network">Network</option>
                                        <option value="threat">Threat</option>
                                        <option value="identity">Identity</option>
                                        <option value="audit">Audit</option>
                                    </select>
                                    <select id="filter-datasource" class="filter-select">
                                        <option value="">All Datasources</option>
                                    </select>
                                </div>
                                <div class="filter-row">
                                    <select id="filter-mitre" class="filter-select">
                                        <option value="">All MITRE</option>
                                    </select>
                                    <select id="filter-origin" class="filter-select">
                                        <option value="">All Origins</option>
                                        <option value="custom">Custom</option>
                                        <option value="escu">ESCU</option>
                                        <option value="sigma">Sigma</option>
                                    </select>
                                </div>
                            </div>
                            <div class="library-list-header">
                                <span id="library-count">0 detections</span>
                            </div>
                            <div id="library-list" class="library-list"></div>
                        </aside>
                        <!-- Main content area - Detection Document -->
                        <div class="library-main">
                            <div id="detail-placeholder" class="detail-placeholder">
                                <span class="placeholder-icon">üìã</span>
                                <p>Select a detection from the sidebar to view documentation</p>
                            </div>
                            <div id="library-detail-content" class="library-detail-content hidden">
                                <div class="detail-header">
                                    <div class="detail-actions">
                                        <button id="btn-detail-correlation" class="btn-action" title="Edit Correlation Search in Splunk">Correlation</button>
                                        <button id="btn-detail-tune" class="btn-action" title="Record Tuning">Tune</button>
                                        <button id="btn-detail-retrofit" class="btn-action" title="Record Retrofit">Retrofit</button>
                                        <button id="btn-detail-metadata" class="btn-action" title="View Metadata">Metadata</button>
                                        <button id="btn-detail-edit" class="btn-action btn-primary" title="Edit Detection">Edit</button>
                                        <button id="btn-detail-delete" class="btn-action btn-danger" title="Delete Detection">Delete</button>
                                    </div>
                                </div>
                                <div id="library-detail-body" class="detail-body"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Editor View -->
                <section id="view-editor" class="view">
                    <div class="editor-layout">
                        <!-- Editor Main Content -->
                        <div class="editor-main">
                            <!-- Editor Toolbar -->
                            <div class="editor-toolbar">
                                <div class="editor-toolbar-left">
                                    <button id="btn-editor-new" class="btn-action" onclick="createNewDetection()">New</button>
                                    <button id="btn-editor-load" class="btn-action" onclick="openLoadModal()">Load</button>
                                </div>
                                <div class="editor-toolbar-tabs">
                                    <button class="editor-tab-btn active" data-tab="form" onclick="switchEditorTab('form')">Form</button>
                                    <button class="editor-tab-btn" data-tab="json" onclick="switchEditorTab('json')">JSON</button>
                                </div>
                                <div class="editor-toolbar-right">
                                    <button id="btn-editor-cancel" class="btn-action" onclick="cancelEditor()">Cancel</button>
                                    <button id="btn-editor-save" class="btn-action btn-primary" onclick="saveDetection()" disabled>Save</button>
                                </div>
                            </div>

                            <!-- Form Tab -->
                            <div id="editor-tab-form" class="editor-tab-content active">
                                <form id="detection-form" class="detection-form">
                                    <!-- Section 1: Basic Information -->
                                    <div class="form-section" data-section="1">
                                        <div class="section-header" onclick="toggleFormSection(1)">
                                            <span class="section-toggle">-</span>
                                            <h3>Basic Information</h3>
                                        </div>
                                        <div class="section-content">
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-detection-name">Detection Name <span class="required">*</span></label>
                                                    <input type="text" id="field-detection-name" name="Detection Name" class="form-input" placeholder="e.g., Access - T1059 - Command Line Interface">
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-objective">Objective <span class="required">*</span></label>
                                                    <textarea id="field-objective" name="Objective" class="form-textarea" rows="3" placeholder="What does this detection aim to identify?"></textarea>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-description">Description</label>
                                                    <textarea id="field-description" name="Description" class="form-textarea" rows="3" placeholder="Detailed description of the detection"></textarea>
                                                </div>
                                            </div>
                                            <div class="form-row two-col">
                                                <div class="form-group">
                                                    <label for="field-severity">Severity/Priority <span class="required">*</span></label>
                                                    <select id="field-severity" name="Severity/Priority" class="form-select">
                                                        <option value="">Select Severity</option>
                                                        <option value="critical">Critical</option>
                                                        <option value="high">High</option>
                                                        <option value="medium">Medium</option>
                                                        <option value="low">Low</option>
                                                        <option value="informational">Informational</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="field-domain">Security Domain</label>
                                                    <select id="field-domain" name="Security Domain" class="form-select">
                                                        <option value="">Select Domain</option>
                                                        <option value="access">Access</option>
                                                        <option value="endpoint">Endpoint</option>
                                                        <option value="network">Network</option>
                                                        <option value="threat">Threat</option>
                                                        <option value="identity">Identity</option>
                                                        <option value="audit">Audit</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-row two-col">
                                                <div class="form-group">
                                                    <label for="field-origin">Origin</label>
                                                    <select id="field-origin" name="origin" class="form-select">
                                                        <option value="custom">Custom</option>
                                                        <option value="escu">ESCU</option>
                                                        <option value="sigma">Sigma</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label>Roles & Ownership</label>
                                                    <div class="roles-container" id="roles-container">
                                                        <div class="role-row">
                                                            <span class="role-label">Requestor:</span>
                                                            <input type="text" id="field-role-requestor-name" class="form-input" placeholder="Name">
                                                            <input type="text" id="field-role-requestor-title" class="form-input" placeholder="Title">
                                                        </div>
                                                        <div class="role-row">
                                                            <span class="role-label">Business Owner:</span>
                                                            <input type="text" id="field-role-business-name" class="form-input" placeholder="Name">
                                                            <input type="text" id="field-role-business-title" class="form-input" placeholder="Title">
                                                        </div>
                                                        <div class="role-row">
                                                            <span class="role-label">Technical Owner:</span>
                                                            <input type="text" id="field-role-technical-name" class="form-input" placeholder="Name">
                                                            <input type="text" id="field-role-technical-title" class="form-input" placeholder="Title">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-mitre">MITRE ATT&CK IDs</label>
                                                    <input type="text" id="field-mitre" name="Mitre ID" class="form-input" placeholder="e.g., T1059, T1059.001 (comma-separated)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 2: Search Configuration -->
                                    <div class="form-section" data-section="2">
                                        <div class="section-header" onclick="toggleFormSection(2)">
                                            <span class="section-toggle">-</span>
                                            <h3>Search Configuration</h3>
                                        </div>
                                        <div class="section-content">
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-search-string">Search String (SPL) <span class="required">*</span></label>
                                                    <textarea id="field-search-string" name="Search String" class="form-textarea code-input" rows="8" placeholder="| search index=..."></textarea>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-datasources">Required Data Sources <span class="required">*</span></label>
                                                    <input type="text" id="field-datasources" name="Required_Data_Sources" class="form-input" placeholder="Auto-populated from SPL or enter manually">
                                                    <small class="form-hint">Parsed from SPL - editable</small>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-assumptions">Assumptions</label>
                                                    <textarea id="field-assumptions" name="Assumptions" class="form-textarea" rows="2" placeholder="Environmental assumptions for this detection"></textarea>
                                                </div>
                                            </div>

                                            <!-- Parsed SPL Metadata Preview -->
                                            <div id="spl-parsed-preview" class="spl-parsed-preview hidden">
                                                <div class="spl-parsed-title">Parsed from SPL</div>
                                                <div id="spl-parsed-content" class="spl-parsed-content"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 3: Risk Configuration (Collapsible) -->
                                    <div class="form-section collapsed" data-section="3">
                                        <div class="section-header" onclick="toggleFormSection(3)">
                                            <span class="section-toggle">+</span>
                                            <h3>Risk Configuration</h3>
                                        </div>
                                        <div class="section-content">
                                            <div id="risk-entries-container">
                                                <div class="risk-entry" data-risk-index="0">
                                                    <div class="form-row three-col">
                                                        <div class="form-group">
                                                            <label>Risk Object Field <span class="required">*</span></label>
                                                            <input type="text" class="form-input risk-field" placeholder="e.g., $user$">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Risk Object Type</label>
                                                            <select class="form-select risk-type">
                                                                <option value="user">User</option>
                                                                <option value="system">System</option>
                                                                <option value="other">Other</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Risk Score <span class="required">*</span></label>
                                                            <input type="number" class="form-input risk-score" min="0" max="100" value="0">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <button type="button" class="btn-action btn-small" onclick="addRiskEntry()">+ Add Risk Entry</button>
                                        </div>
                                    </div>

                                    <!-- Section 4: Notable Event -->
                                    <div class="form-section" data-section="4">
                                        <div class="section-header" onclick="toggleFormSection(4)">
                                            <span class="section-toggle">-</span>
                                            <h3>Notable Event</h3>
                                        </div>
                                        <div class="section-content">
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-notable-title">Notable Title <span class="required">*</span></label>
                                                    <input type="text" id="field-notable-title" name="Notable Title" class="form-input" placeholder="Auto-populated from Detection Name">
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-notable-desc">Notable Description</label>
                                                    <textarea id="field-notable-desc" name="Notable Description" class="form-textarea" rows="3" placeholder="Description shown in notable event"></textarea>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-analyst-steps">Analyst Next Steps <span class="required">*</span></label>
                                                    <textarea id="field-analyst-steps" name="Analyst Next Steps" class="form-textarea" rows="4" placeholder="Step-by-step investigation guidance"></textarea>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-blind-spots">Blind Spots / False Positives <span class="required">*</span></label>
                                                    <textarea id="field-blind-spots" name="Blind_Spots_False_Positives" class="form-textarea" rows="3" placeholder="Known limitations and potential false positives"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 5: Scheduling (Collapsible) -->
                                    <div class="form-section collapsed" data-section="5">
                                        <div class="section-header" onclick="toggleFormSection(5)">
                                            <span class="section-toggle">+</span>
                                            <h3>Scheduling</h3>
                                        </div>
                                        <div class="section-content">
                                            <div class="form-row three-col">
                                                <div class="form-group">
                                                    <label for="field-cron">Cron Schedule</label>
                                                    <input type="text" id="field-cron" name="Cron Schedule" class="form-input" placeholder="*/5 * * * *">
                                                </div>
                                                <div class="form-group">
                                                    <label for="field-schedule-window">Schedule Window</label>
                                                    <input type="text" id="field-schedule-window" name="Schedule Window" class="form-input" placeholder="auto">
                                                </div>
                                                <div class="form-group">
                                                    <label for="field-schedule-priority">Schedule Priority</label>
                                                    <select id="field-schedule-priority" name="Schedule Priority" class="form-select">
                                                        <option value="">Default</option>
                                                        <option value="higher">Higher</option>
                                                        <option value="highest">Highest</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-trigger">Trigger Condition</label>
                                                    <input type="text" id="field-trigger" name="Trigger Condition" class="form-input" placeholder="search count > 0">
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <h4 class="sub-section-title">Throttling</h4>
                                            </div>
                                            <div class="form-row three-col">
                                                <div class="form-group">
                                                    <label for="field-throttle-enabled">Throttle Enabled</label>
                                                    <select id="field-throttle-enabled" class="form-select">
                                                        <option value="0">No</option>
                                                        <option value="1">Yes</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="field-throttle-fields">Throttle Fields</label>
                                                    <input type="text" id="field-throttle-fields" class="form-input" placeholder="user, dest">
                                                </div>
                                                <div class="form-group">
                                                    <label for="field-throttle-period">Throttle Period</label>
                                                    <input type="text" id="field-throttle-period" class="form-input" placeholder="86400s">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 6: Drilldowns (Collapsible) -->
                                    <div class="form-section collapsed" data-section="6">
                                        <div class="section-header" onclick="toggleFormSection(6)">
                                            <span class="section-toggle">+</span>
                                            <h3>Drilldowns</h3>
                                        </div>
                                        <div class="section-content">
                                            <div id="drilldowns-container">
                                                <!-- Drilldowns will be added dynamically -->
                                            </div>
                                            <button type="button" class="btn-action btn-small" onclick="addDrilldown()">+ Add Drilldown</button>
                                        </div>
                                    </div>

                                    <!-- Section 7: Test Plan (Collapsible) -->
                                    <div class="form-section collapsed" data-section="7">
                                        <div class="section-header" onclick="toggleFormSection(7)">
                                            <span class="section-toggle">+</span>
                                            <h3>Proposed Test Plan</h3>
                                        </div>
                                        <div class="section-content">
                                            <div class="form-row">
                                                <div class="form-group full-width">
                                                    <label for="field-test-plan">Test Plan</label>
                                                    <textarea id="field-test-plan" name="Proposed Test Plan" class="form-textarea" rows="4" placeholder="Steps to validate this detection"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <!-- JSON Tab -->
                            <div id="editor-tab-json" class="editor-tab-content">
                                <div class="json-editor-container">
                                    <textarea id="json-editor" class="json-editor" placeholder="Paste or edit JSON here..."></textarea>
                                    <div class="json-editor-actions">
                                        <button class="btn-action" onclick="formatJson()">Format JSON</button>
                                        <button class="btn-action" onclick="applyJsonToForm()">Apply to Form</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Validation Sidebar -->
                        <aside class="editor-sidebar">
                            <div class="validation-panel">
                                <div class="validation-header">
                                    <h3>Validation</h3>
                                    <span id="validation-status" class="validation-status">Not Ready</span>
                                </div>
                                <div id="validation-content" class="validation-content">
                                    <div class="validation-section">
                                        <h4>Required Fields</h4>
                                        <ul id="validation-errors" class="validation-list">
                                            <li class="validation-item error">Detection Name is required</li>
                                        </ul>
                                    </div>
                                    <div class="validation-section">
                                        <h4>Warnings</h4>
                                        <ul id="validation-warnings" class="validation-list">
                                            <!-- Warnings will be populated here -->
                                        </ul>
                                    </div>
                                    <div class="validation-section">
                                        <h4 id="missing-macros-header" class="hidden">Missing Macros</h4>
                                        <ul id="missing-macros-list" class="validation-list macro-list">
                                            <!-- Missing macros will be clickable links -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </div>
                </section>
                <!-- Macros View -->
                <section id="view-macros" class="view">
                    <div class="macros-layout">
                        <!-- Macros Sidebar -->
                        <aside class="macros-sidebar">
                            <div class="macros-toolbar">
                                <button id="btn-macro-new" class="btn-action btn-primary" onclick="createNewMacro()">+ New Macro</button>
                            </div>
                            <div class="macros-search">
                                <input type="text" id="macros-search-input" class="search-input" placeholder="Search macros..." oninput="filterMacros()">
                            </div>
                            <div class="macros-filter-row">
                                <select id="macros-sort" class="filter-select" onchange="filterMacros()">
                                    <option value="name-asc">Name A-Z</option>
                                    <option value="name-desc">Name Z-A</option>
                                    <option value="most-used">Most Used</option>
                                    <option value="least-used">Least Used</option>
                                </select>
                                <label class="toggle-label">
                                    <input type="checkbox" id="macros-show-deprecated" onchange="filterMacros()">
                                    <span>Show deprecated</span>
                                </label>
                            </div>
                            <div class="macros-list-header">
                                <span id="macros-count">0 macros</span>
                            </div>
                            <div id="macros-list" class="macros-list"></div>
                        </aside>

                        <!-- Macro Detail/Edit Panel -->
                        <div class="macros-main">
                            <div id="macro-placeholder" class="detail-placeholder">
                                <span class="placeholder-icon">&#x2699;</span>
                                <p>Select a macro from the sidebar or create a new one</p>
                            </div>
                            <div id="macro-detail-content" class="macro-detail-content hidden">
                                <div class="macro-detail-header">
                                    <h3 id="macro-detail-title">Macro Details</h3>
                                    <div class="macro-detail-actions">
                                        <button id="btn-macro-cancel" class="btn-action" onclick="cancelMacroEdit()">Cancel</button>
                                        <button id="btn-macro-save" class="btn-action btn-primary" onclick="saveMacroEdit()">Save</button>
                                        <button id="btn-macro-delete" class="btn-action btn-danger" onclick="confirmDeleteMacroUI()">Delete</button>
                                    </div>
                                </div>
                                <div class="macro-detail-body">
                                    <form id="macro-form" class="macro-form">
                                        <div class="form-group">
                                            <label for="macro-field-name">Macro Name <span class="required">*</span></label>
                                            <input type="text" id="macro-field-name" class="form-input" placeholder="my_macro_name">
                                            <small class="form-hint">No spaces allowed, use underscores. Example: security_content_summariesonly</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="macro-field-definition">Definition <span class="required">*</span></label>
                                            <textarea id="macro-field-definition" class="form-textarea code-input" rows="6" placeholder="summariesonly=true"></textarea>
                                            <small class="form-hint">SPL fragment that this macro expands to</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="macro-field-description">Description</label>
                                            <textarea id="macro-field-description" class="form-textarea" rows="3" placeholder="What does this macro do?"></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label for="macro-field-arguments">Arguments</label>
                                            <input type="text" id="macro-field-arguments" class="form-input" placeholder="arg1, arg2">
                                            <small class="form-hint">Comma-separated list of arguments (e.g., earliest, latest)</small>
                                        </div>
                                        <div class="form-group">
                                            <label class="toggle-label inline">
                                                <input type="checkbox" id="macro-field-deprecated">
                                                <span>Mark as deprecated</span>
                                            </label>
                                        </div>
                                    </form>

                                    <!-- Usage Section -->
                                    <div id="macro-usage-section" class="macro-usage-section hidden">
                                        <h4>Usage in Detections</h4>
                                        <div id="macro-usage-list" class="macro-usage-list">
                                            <!-- Detection usage will be listed here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Revalidation View -->
                <section id="view-revalidation" class="view">
                    <div class="revalidation-layout">
                        <!-- Sidebar - Filters + Detection List -->
                        <aside class="revalidation-sidebar">
                            <!-- Status Classification Checkboxes -->
                            <div class="revalidation-status-filters">
                                <div class="status-filter-header">Status Classification</div>
                                <div class="status-checkbox-group">
                                    <label class="status-checkbox valid">
                                        <input type="checkbox" id="reval-status-valid" checked onchange="filterRevalidation()">
                                        <span class="status-label">Valid</span>
                                        <span id="reval-count-valid" class="status-count">0</span>
                                    </label>
                                    <label class="status-checkbox incomplete">
                                        <input type="checkbox" id="reval-status-incomplete" checked onchange="filterRevalidation()">
                                        <span class="status-label">Incomplete</span>
                                        <span id="reval-count-incomplete" class="status-count">0</span>
                                    </label>
                                    <label class="status-checkbox needs-tune">
                                        <input type="checkbox" id="reval-status-needs-tune" checked onchange="filterRevalidation()">
                                        <span class="status-label">Needs Tune</span>
                                        <span id="reval-count-needs-tune" class="status-count">0</span>
                                    </label>
                                    <label class="status-checkbox needs-retrofit">
                                        <input type="checkbox" id="reval-status-needs-retrofit" checked onchange="filterRevalidation()">
                                        <span class="status-label">Needs Retrofit</span>
                                        <span id="reval-count-needs-retrofit" class="status-count">0</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Batch Operations -->
                            <div class="revalidation-batch-ops">
                                <div class="batch-ops-header">Batch Operations</div>
                                <div class="batch-ops-buttons">
                                    <button class="btn-action btn-batch" id="btn-batch-tune" onclick="batchMarkAsTuned()" disabled>Mark as Tuned</button>
                                    <button class="btn-action btn-batch" id="btn-batch-retrofit" onclick="batchMarkAsRetrofitted()" disabled>Mark as Retrofitted</button>
                                </div>
                                <div id="batch-selection-count" class="batch-selection-info">Select detections below</div>
                            </div>

                            <!-- Splunk Dashboard Link -->
                            <div class="revalidation-splunk-link">
                                <button class="btn-action btn-splunk-dashboard" onclick="openSplunkRevalidationDashboard()">
                                    <span class="splunk-icon">&#x1F4CA;</span> Open Splunk Revalidation Dashboard
                                </button>
                            </div>

                            <!-- Detection List Header -->
                            <div class="revalidation-list-header">
                                <label class="select-all-checkbox">
                                    <input type="checkbox" id="reval-select-all" onchange="toggleRevalidationSelectAll()">
                                    <span>Select All</span>
                                </label>
                                <span id="revalidation-count">0 detections</span>
                            </div>

                            <!-- Detection List -->
                            <div id="revalidation-list" class="revalidation-list"></div>
                        </aside>

                        <!-- Main content area - Detection Detail -->
                        <div class="revalidation-main">
                            <div id="reval-detail-placeholder" class="detail-placeholder">
                                <span class="placeholder-icon">&#x1F504;</span>
                                <p>Select a detection from the sidebar to view revalidation details</p>
                            </div>
                            <div id="reval-detail-content" class="revalidation-detail-content hidden">
                                <div class="reval-detail-header">
                                    <div class="reval-detail-actions">
                                        <button id="btn-reval-correlation" class="btn-action" title="Edit Correlation Search in Splunk">Correlation</button>
                                        <button id="btn-reval-tune" class="btn-action btn-primary" title="Mark as Tuned">Mark as Tuned</button>
                                        <button id="btn-reval-retrofit" class="btn-action btn-primary" title="Mark as Retrofitted">Mark as Retrofitted</button>
                                        <button id="btn-reval-view-library" class="btn-action" title="View in Library">View in Library</button>
                                    </div>
                                </div>
                                <div id="reval-detail-body" class="reval-detail-body"></div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- History View -->
                <section id="view-history" class="view">
                    <div class="history-layout">
                        <!-- Sidebar - Filters -->
                        <aside class="history-sidebar">
                            <!-- Date Range Filter -->
                            <div class="history-filter-section">
                                <div class="filter-section-header">Date Range</div>
                                <div class="date-range-picker">
                                    <div class="form-group">
                                        <label for="history-date-from">From</label>
                                        <input type="date" id="history-date-from" class="form-input date-input" onchange="filterHistory()">
                                    </div>
                                    <div class="form-group">
                                        <label for="history-date-to">To</label>
                                        <input type="date" id="history-date-to" class="form-input date-input" onchange="filterHistory()">
                                    </div>
                                    <div class="date-range-presets">
                                        <button class="preset-btn" onclick="setDatePreset('7d')">7 days</button>
                                        <button class="preset-btn" onclick="setDatePreset('30d')">30 days</button>
                                        <button class="preset-btn" onclick="setDatePreset('90d')">90 days</button>
                                        <button class="preset-btn" onclick="setDatePreset('all')">All time</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Change Type Filter -->
                            <div class="history-filter-section">
                                <div class="filter-section-header">Change Type</div>
                                <div class="change-type-checkboxes">
                                    <label class="change-type-checkbox created">
                                        <input type="checkbox" id="history-type-created" checked onchange="filterHistory()">
                                        <span class="change-type-label">Created</span>
                                        <span id="history-count-created" class="change-type-count">0</span>
                                    </label>
                                    <label class="change-type-checkbox tuned">
                                        <input type="checkbox" id="history-type-tuned" checked onchange="filterHistory()">
                                        <span class="change-type-label">Tuned</span>
                                        <span id="history-count-tuned" class="change-type-count">0</span>
                                    </label>
                                    <label class="change-type-checkbox retrofitted">
                                        <input type="checkbox" id="history-type-retrofitted" checked onchange="filterHistory()">
                                        <span class="change-type-label">Retrofitted</span>
                                        <span id="history-count-retrofitted" class="change-type-count">0</span>
                                    </label>
                                    <label class="change-type-checkbox modified">
                                        <input type="checkbox" id="history-type-modified" checked onchange="filterHistory()">
                                        <span class="change-type-label">Modified</span>
                                        <span id="history-count-modified" class="change-type-count">0</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Detection Name Search -->
                            <div class="history-filter-section">
                                <div class="filter-section-header">Detection Search</div>
                                <div class="history-search">
                                    <input type="text" id="history-search-input" class="search-input" placeholder="Search detections..." oninput="filterHistory()">
                                </div>
                            </div>

                            <!-- Results Count -->
                            <div class="history-list-header">
                                <span id="history-count">0 changes</span>
                            </div>
                        </aside>

                        <!-- Main content area - Timeline -->
                        <div class="history-main">
                            <div id="history-timeline" class="history-timeline">
                                <!-- Timeline entries will be populated here -->
                            </div>
                        </div>
                    </div>
                </section>
                <section id="view-resources" class="view">
                    <div class="content-header"><h2>Resources</h2></div>
                    <div class="content-body"><p class="placeholder-text">Resources view coming soon.</p></div>
                </section>
                <section id="view-reports" class="view">
                    <div class="content-header"><h2>Reports</h2></div>
                    <div class="content-body"><p class="placeholder-text">Reports view coming soon.</p></div>
                </section>
                <section id="view-settings" class="view">
                    <div class="content-header"><h2>Settings</h2></div>
                    <div class="content-body"><p class="placeholder-text">Settings view coming soon.</p></div>
                </section>
            </main>

            <!-- Macro Modal -->
            <div id="modal-macro" class="modal hidden">
                <div class="modal-overlay"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="macro-modal-title">Macro Details</h3>
                        <button class="modal-close" onclick="closeMacroModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div id="macro-modal-content">
                            <p class="macro-name"><code id="macro-name-display"></code></p>
                            <p class="macro-hint">This macro is used in the detection's search logic.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-action" onclick="closeMacroModal()">Close</button>
                    </div>
                </div>
            </div>

            <!-- Metadata Modal -->
            <div id="modal-metadata" class="modal hidden">
                <div class="modal-overlay"></div>
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3>Detection Metadata</h3>
                        <div class="modal-header-actions">
                            <div class="metadata-view-toggle">
                                <button class="toggle-btn active" data-view="formatted" onclick="switchMetadataView('formatted')">Formatted</button>
                                <button class="toggle-btn" data-view="json" onclick="switchMetadataView('json')">JSON</button>
                            </div>
                            <button class="modal-close" onclick="closeMetadataModal()">√ó</button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div id="metadata-detection-name" class="metadata-title"></div>
                        <div id="metadata-formatted" class="metadata-formatted"></div>
                        <div id="metadata-json" class="metadata-json hidden">
                            <pre id="metadata-json-content" class="json-display"></pre>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-action" onclick="copyMetadataJson()">Copy JSON</button>
                        <button class="btn-action" onclick="closeMetadataModal()">Close</button>
                    </div>
                </div>
            </div>

            <!-- Confirm Modal -->
            <div id="modal-confirm" class="modal hidden">
                <div class="modal-overlay"></div>
                <div class="modal-content modal-small">
                    <div class="modal-header">
                        <h3>Confirm</h3>
                        <button class="modal-close" onclick="closeConfirmModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <p id="confirm-message">Are you sure?</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-action" onclick="closeConfirmModal()">Cancel</button>
                        <button id="btn-confirm-yes" class="btn-action btn-danger">Confirm</button>
                    </div>
                </div>
            </div>

            <!-- Load Detection Modal -->
            <div id="modal-load" class="modal hidden">
                <div class="modal-overlay" onclick="closeLoadModal()"></div>
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3>Load Detection</h3>
                        <button class="modal-close" onclick="closeLoadModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="load-search">
                            <input type="text" id="load-search-input" class="form-input" placeholder="Search detections..." oninput="filterLoadList()">
                        </div>
                        <div id="load-list" class="load-list">
                            <!-- Detection items will be populated here -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-action" onclick="closeLoadModal()">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Unsaved Changes Modal -->
            <div id="modal-unsaved" class="modal hidden">
                <div class="modal-overlay"></div>
                <div class="modal-content modal-small">
                    <div class="modal-header">
                        <h3>Unsaved Changes</h3>
                        <button class="modal-close" onclick="closeUnsavedModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <p>You have unsaved changes. Do you want to save before leaving?</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-action" onclick="discardChanges()">Discard</button>
                        <button class="btn-action btn-primary" onclick="saveAndContinue()">Save</button>
                    </div>
                </div>
            </div>

            <!-- Status Bar -->
            <footer class="status-bar">
                <div class="status-left">
                    <span class="status-indicator status-disconnected"></span>
                    <span class="status-text">Disconnected</span>
                </div>
                <div class="status-right">
                    <span class="status-version">v1.0.0</span>
                </div>
            </footer>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
